(self.webpackChunkpolicies_ui_frontend=self.webpackChunkpolicies_ui_frontend||[]).push([[661],{21958:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var n=i(94015),a=i.n(n),r=i(23645),o=i.n(r),l=i(35747),s=i(42454),c=o()(a());c.i(l.Z),c.i(s.Z),c.push([e.id,".policies{}.policies :root{--ins-color--orange: #ec7a08}.policies button:focus{outline:none}.policies .pf-c-wizard__main-body{max-height:100%}\n","",{version:3,sources:["webpack://./src/app/App.scss"],names:[],mappings:"AAAA,UAAS,CAAT,gBAC0J,4BAAoB,CAD9K,uBACoM,YAAY,CADhN,kCACyO,eAAe",sourcesContent:[".policies{\n@import url(~@redhat-cloud-services/frontend-components/index.css);@import url(~@redhat-cloud-services/frontend-components-notifications/index.css);:root{--ins-color--orange: #ec7a08}button:focus{outline:none}.pf-c-wizard__main-body{max-height:100%}\n\n}"],sourceRoot:""}]);const d=c},32079:(e,t,i)=>{"use strict";var n=i(93379),a=i.n(n),r=i(21958),o=a()(r.default,{insert:"head",singleton:!1});if(!r.default.locals||e.hot.invalidate){var l=r.default.locals;e.hot.accept(21958,(t=>{r=i(21958),function(e,t,i){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(l,r.default.locals)?(l=r.default.locals,o(r.default)):e.hot.invalidate()}))}e.hot.dispose((function(){o()})),r.default.locals},73851:(e,t,i)=>{"use strict";i.d(t,{Z:()=>na}),i(32079);var n=i(30781),a=i(55128),r=i(1427),o=i(5569),l=i(81617),s=i(87473),c=i(11331),d=i(47435),u=i(56894);const p=(0,a.getOuiaPropsFactory)("Policies"),m=(0,u.style)({paddingTop:(0,d.calc)(`${c.default.value} - var(--pf-c-page__main-section--PaddingTop)`)}),g=e=>r.createElement(s.EmptyState,Object.assign({variant:s.EmptyStateVariant.full,className:`${m} ${e.className?e.className:""} `},p("Policy/EmptyState",e)),e.icon&&r.createElement(s.EmptyStateIcon,{icon:e.icon,color:e.iconColor}),r.createElement(s.Title,{headingLevel:"h5",size:"lg"},e.title),r.createElement(s.EmptyStateBody,null,e.content),e.actionNode,e.actionLabel&&r.createElement(s.Button,{variant:"primary",onClick:e.action,isDisabled:!e.action},e.actionLabel));var y;!function(e){e.EMAIL="email",e.NOTIFICATION="notification"}(y||(y={}));const h={pages:{noPermissions:{title:"Policies",emptyState:{title:"You do not have access to Policies",content:"Contact your organization administrator(s) for more information."}},error:{title:"Policies",emptyState:{title:"Unhandled error",content:"There was a problem trying to process your request.",showDetails:"Show details",actions:{goToIndex:"Go to Policy list"}}},listPage:{title:"Policies",emailOptIn:"One or more of your policies have an email alert. To receive these emails, opt in to email alerts.",emptyState:{title:"No Policies",text:["No policies have been created.","Use self defined-policies to monitor your RHEL configurations with instant or daily alerts."]}},policyDetail:{errorChangingEnabledStatus:{notFound:{title:"Policy not found",text:"The policy does not exists on the server. It may have been removed by another user."},else:{title:"Enabled status change failed for policy",text:"There was an error setting the enabled status for this policy. Please try again."}},emptyState:{title:"Policy not found",text:"This policy with ID {0} cannot be found. It may have been removed by another user.",backText:"Back to previous page"},triggerEmptyState:{title:"No triggers found",text:"This policy does not have any recent triggers"},errorState:{title:"Error when loading policy",text:"Error loading this policy.\nError {0}",actionText:"Try again"},triggerErrorState:{title:"Error when loading trigger history for policy",text:"Error loading trigger history for this policy.\nError {0}",actionText:"Try again"}}},components:{actions:{title:"Trigger actions",noActions:"No actions configured."},actionType:{[y.EMAIL]:"Email",[y.NOTIFICATION]:"Notification"},emailOptIn:{title:"Enable email alerts",switch:"Get emails when a policy runs",link:"Open email preferences"},lastTriggeredCell:{never:"Never",ago:"ago"},actionNotificationForm:{paragraph1:{head:"This action sends a request notification to process the message as configured in ",link:"notification settings.",tail:""},paragraph2:{head:"To configure it for policies, open the notification in the ",link:"notification settings",tail:' and select your preference for sending under "Policies / All".'}}},tables:{policy:{title:"Policies",columns:{name:"Name",triggerActions:"Trigger actions",lastTriggered:"Last triggered"},emptyState:{neverRun:"Never",noConditions:"No conditions configured.",noDescription:"--",notFound:{title:"No matching policies found",content:"No policies matching the selected filter and search terms."}},actions:{email:"Send email",notification:"Send a notification"}},trigger:{title:"Trigger",columns:{date:"Date",system:"System"},emptyState:{notFound:{title:"No matching triggers found",content:"No triggers matching the search terms."}}}},wizards:{policy:{titleNew:"Create a policy",titleEdit:"Edit a policy",description:"Policies are processed on reception of system profile messages. If condition(s) are met, defined action(s) are triggered.",actions:{title:"Trigger actions",emailOptIn:"To receive emails for custom policies, opt in to email alerts from your user preferences."},conditions:{title:"Conditions",valid:"Valid condition",invalid:"Invalid condition",validating:"Validatingâ€¦",hint:'e.g. facts.arch = "x86_64"',summaryDesc:"Define conditions for your policy using any system facts."},hints:{hintTitle:"What conditions can I define?",hintParagraph1:"You can write a condition for any combination of system facts that apply to your Insights inventory systems.",hintLinkTitle:"Review available system facts",hintSyntaxExamplesSection:"Syntax examples",hintQuestion1:"Is wireshark RPM installed?",hintQuestion1Ans:"facts.installed_packages contains ['wireshark']",hintQuestion2:"Is the release older than RHEL 8.1?",hintQuestion2Ans:"facts.os_release < 8.1",hintQuestion3:"Which of my public cloud instances are missing a tag Owner value set?",hintQuestion3Ans:"facts.cloud_provider in ['alibaba',aws','azure','google'] and not tags.Owner",hintQuestion4:"Is time synchronization configured for RHEL7 and RHEL8?",hintQuestion4Ans:"(facts.os_release >=7 and facts.os_release <8 and not facts.enabled_services contains 'ntpd') or (facts.os_release >=8 and not facts.enabled_services contains 'chronyd')"},createPolicy:{title:"Create Policy"},details:{title:"Policy Details"},review:{title:"Review and enable",enableThisPolicy:"Enable this policy?",policyIsEnabled:"Policy is enabled",policyIsDisabled:"Policy is disabled",policy:{details:"Policy details",name:"Policy name",description:"Description"}}}},labels:{description:"Description"}},E=()=>r.createElement(r.Fragment,null,r.createElement(l.PageHeader,null,r.createElement(l.PageHeaderTitle,{title:h.pages.noPermissions.title})),r.createElement(l.Main,null,r.createElement(g,{icon:o.ZP,title:h.pages.noPermissions.emptyState.title,content:h.pages.noPermissions.emptyState.content})));var v=i(77150);const b=(0,v.EN)((e=>{const t=r.useCallback((()=>{e.history.push(Yn.listPage())}),[e.history]);return r.createElement(a.ErrorBoundaryPage,{action:t,actionLabel:h.pages.error.emptyState.actions.goToIndex,pageHeader:h.pages.error.title,title:h.pages.error.emptyState.title,description:h.pages.error.emptyState.content},e.children)}));var f=i(64593),_=i(37176);const T=r.createContext({rbac:{canReadPolicies:!1,canWritePolicies:!1},userSettings:{settings:void 0,isSubscribedForNotifications:!1,refresh:()=>{console.error("Using default refresh function")}}});var C=i(8870),P=i(46242),S=i(98149),x=i(96893),O=i(69455);const N=()=>r.createElement(O.ZP,null);var I=i(35451);const R=()=>r.createElement(I.ZP,{color:"green"});var w=i(36853);const A=x.ZP,k=()=>r.createElement(w.ZP,null),L=e=>{const{actionType:t}=e,i=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i}(e,["actionType"]);switch(t){case y.NOTIFICATION:return r.createElement(k,Object.assign({},i));case y.EMAIL:return r.createElement(A,Object.assign({},i));case void 0:break;default:(0,P.vE)(t)}return null},D=(0,u.style)({borderRadius:3}),F=(0,u.style)({marginRight:5}),M=(0,u.style)({minWidth:145}),V=s.TooltipPosition.bottom,B=()=>r.createElement(s.Tooltip,{content:h.tables.policy.actions.email,position:V},r.createElement(A,null)),U=()=>r.createElement(s.Tooltip,{content:h.tables.policy.actions.notification,position:V},r.createElement(k,null)),j=e=>{const t=e.actions.slice(0,4),i=e.actions.slice(4),n=t.map(((e,t)=>{let i;switch(e.type){case y.EMAIL:i=r.createElement(B,null);break;case y.NOTIFICATION:i=r.createElement(U,null);break;default:(0,P.vE)(e)}return r.createElement(s.SplitItem,{key:t,className:F},i)}));return i.length>0&&n.push(r.createElement(s.SplitItem,{key:"remaining",className:F},r.createElement(s.Badge,{className:D,isRead:!0},`${i.length} more`))),r.createElement(s.Split,Object.assign({},p("Policy/Table/Actions",e),{className:M}),n)};var G=i(86031),z=i(98207);const H=(0,u.style)({marginBottom:5}),Q=(0,u.style)({marginBottom:5,marginLeft:10,display:"inline"}),q=(0,u.style)({marginBottom:10,marginTop:10,marginLeft:10}),Z=(0,u.style)({marginLeft:25,marginBottom:8,marginTop:8}),$=e=>r.createElement(s.StackItem,{className:q},r.createElement(e.icon,null),r.createElement(s.Title,{headingLevel:"h2",className:Q,size:"md"},e.title),e.children&&r.createElement("div",{className:Z},e.children)),W=e=>r.createElement(r.Fragment,null,r.createElement(s.Stack,Object.assign({},p("Policy/Table/Expanded/Actions",e)),r.createElement(s.StackItem,null,r.createElement(s.Title,{headingLevel:"h2",className:H,size:"md"},h.components.actions.title)),0===e.actions.length?r.createElement(s.Text,null," ",h.components.actions.noActions," "):(e=>{const t=[];for(const i in e){const n=e[i];switch(n.type){case y.EMAIL:t.push(r.createElement(r.Fragment,{key:i},r.createElement($,{title:"Send Email",icon:A})));break;case y.NOTIFICATION:t.push(r.createElement(r.Fragment,{key:i},r.createElement($,{title:h.tables.policy.actions.notification,icon:k})));break;default:(0,P.vE)(n)}}return(0,a.join)(t,s.Divider)})(e.actions))),K=(0,u.style)({marginBottom:5}),Y=e=>r.createElement("div",Object.assign({},p("Policy/Table/Expanded/Conditions",e)),r.createElement(s.Title,{headingLevel:"h2",className:K,size:"md"},"Conditions"),r.createElement(s.Text,null,e.conditions||h.tables.policy.emptyState.noConditions));var X=i(93022);const J="dd MMM yyyy",ee=e=>r.createElement(r.Fragment,null,r.createElement(s.Text,Object.assign({},p("Policy/Table/Expanded/Dates",e)),"Last updated ",(0,X.Z)(e.updated,J)," | Created ",(0,X.Z)(e.created,J))),te=e=>r.createElement("div",Object.assign({},p("Policy/Table/Expanded/Description",e)),r.createElement(s.Form,null,r.createElement(s.FormGroup,{fieldId:"",label:h.labels.description})),r.createElement(s.Text,null," ",e.description," ")),ie=(0,u.style)({margin:12}),ne=(0,u.style)({maxWidth:800,marginBottom:12}),ae=(0,u.style)({marginBottom:12}),re=(0,u.style)(Object.assign(Object.assign({backgroundColor:G.ZP.var},(0,z.padding)(18,14)),{margin:5})),oe=e=>r.createElement(s.Stack,Object.assign({},p("Policy/Table/Expanded",e),{className:ie}),e.description&&r.createElement(s.StackItem,{className:ne},r.createElement(te,{ouiaId:(0,a.ouiaIdConcat)(e.ouiaId,"description"),description:e.description})),r.createElement(s.StackItem,{className:ae},r.createElement(ee,{ouiaId:(0,a.ouiaIdConcat)(e.ouiaId,"dates"),updated:e.updated,created:e.created})),r.createElement(s.StackItem,null,r.createElement(s.Grid,null,r.createElement(s.GridItem,{className:re,span:6},r.createElement(Y,{ouiaId:(0,a.ouiaIdConcat)(e.ouiaId,"conditions"),conditions:e.conditions})),r.createElement(s.GridItem,{className:re,span:6},r.createElement(W,{ouiaId:(0,a.ouiaIdConcat)(e.ouiaId,"actions"),actions:e.actions})))));var le=i(43321),se=i(42699),ce=i(17736);const de=(0,u.style)({marginLeft:10}),ue=e=>{let t;if(e.lastTriggered){const i=(0,le.Z)(e.lastTriggered,{months:1}),n=new Date(Date.now());t=(0,se.Z)(n,i)?(0,X.Z)(e.lastTriggered,"MMM dd y"):`${(0,ce.Z)(e.lastTriggered)} ${h.components.lastTriggeredCell.ago}`}else t=h.components.lastTriggeredCell.never;return r.createElement("div",Object.assign({},p("Policy/Table/LastTriggered",e)),e.isEnabled?r.createElement(R,null):r.createElement(N,null),r.createElement("span",{className:de},t))},pe=(0,u.style)({backgroundColor:"white"}),me=["name","actions","is_enabled"],ge=(e,t,i,n)=>t.indexOf(i[e])+n,ye=e=>{const{onSort:t,error:i,policies:n,onCollapse:o,onSelect:c}=e,d=e.columnsToShow||me,u=d.includes("radioSelect");if(u&&!c)throw Error("RadioSelect requires an onSelect");const m=r.useMemo((()=>{const e=t?[C.sortable]:[];return{radioSelect:{title:"",transforms:[]},name:{title:h.tables.policy.columns.name,transforms:e,cellFormatters:[C.expandable],column:"name"},actions:{title:h.tables.policy.columns.triggerActions,transforms:[]},is_enabled:{title:h.tables.policy.columns.lastTriggered,transforms:[],column:"is_enabled"}}}),[t]),y=r.useMemo((()=>[o,d.includes("radioSelect")?void 0:c].filter((e=>e)).length),[o,c,d]),E=r.useMemo((()=>d.map((e=>m[e]))),[m,d]),v=r.useCallback(((e,i,n)=>{if(t){const e=((e,t,i)=>t[e-i].column)(i,E,y);e&&t(i,e,n===C.SortByDirection.asc?a.Direction.ASCENDING:a.Direction.DESCENDING)}}),[t,E,y]),b=r.useCallback(((e,t,i,a)=>{const r=n,l=null==r?void 0:r.findIndex((e=>e.id===a.id));if(o&&r&&void 0!==l&&-1!==l){const e=r[l];o(e,l,i)}}),[n,o]),f=r.useCallback(((e,t,i,a)=>{const r=n,o=null==r?void 0:r.findIndex((e=>e.id===a.id));if(c&&r&&void 0!==o&&-1!==o){const e=r[o];c(e,o,t)}}),[n,c]),_=r.useMemo((()=>{if(e.sortBy)return{index:ge(e.sortBy.column,E,m,y),direction:e.sortBy.direction===a.Direction.ASCENDING?"asc":"desc"}}),[e.sortBy,E,m,y]),T=r.useMemo((()=>e.error||e.loading?void 0:e.actionResolver||void 0),[e.error,e.loading,e.actionResolver]),x=r.useCallback((e=>{if(void 0===e.parent&&T&&e&&n){const t=n.find((t=>t.id===e.id));if(t)return T(t)}return[]}),[T,n]),O=r.useMemo((()=>i?[]:((e,t,i,n)=>e?e.reduce(((a,o,l)=>(a.push({id:o.id,key:o.id,isOpen:o.isOpen,selected:o.isSelected,cells:t.map((t=>{switch(t){case"actions":return r.createElement(r.Fragment,null,r.createElement(j,{ouiaId:o.id,actions:o.actions}));case"is_enabled":return r.createElement(r.Fragment,null,r.createElement(ue,{ouiaId:o.id,isEnabled:o.isEnabled,lastTriggered:o.lastTriggered}));case"name":return r.createElement(r.Fragment,null,i?r.createElement(S.Link,{to:Yn.policyDetail(o.id)},o.name):o.name);case"radioSelect":return r.createElement(r.Fragment,null,r.createElement(s.Radio,{id:`${o.id}-table-radio-id`,"aria-label":`Radio select for policy ${o.name}`,name:"policy-table-radio-select",isChecked:o.isSelected,onChange:n?()=>{const t=e.findIndex((e=>e.isSelected));-1!==t&&n(e[t],t,!1),n(o,l,!0)}:void 0}))}(0,P.vE)(t)}))}),a.push({parent:2*l,fullWidth:!0,showSelect:!1,cells:[{title:r.createElement(r.Fragment,null,r.createElement(oe,{ouiaId:o.id,key:o.id+"-content",description:o.description?o.description:h.tables.policy.emptyState.noDescription,conditions:o.conditions?o.conditions:h.tables.policy.emptyState.noConditions,actions:o.actions,created:o.ctime,updated:o.mtime}))}]}),a)),[]):[])(n,d,e.linkToDetailPolicy,c)),[i,n,d,c,e.linkToDetailPolicy]);return e.loading?r.createElement(l.SkeletonTable,{rowSize:e.loadingRowCount||10,columns:E,paddingColumnSize:y,sortBy:_}):i?r.createElement(g,Object.assign({},i,{className:pe})):r.createElement("div",Object.assign({},p("Policy/Table",e)),r.createElement(C.Table,{"aria-label":h.tables.policy.title,cells:E,rows:O,actionResolver:x,onSort:t?v:void 0,onCollapse:o?b:void 0,onSelect:e.error||!c||u?void 0:f,sortBy:_,canSelectAll:!1},r.createElement(C.TableHeader,null),r.createElement(C.TableBody,null)))};var he,Ee;!function(e){e.NAME="name",e.IS_ACTIVE="is_enabled"}(he||(he={})),function(e){e[e.NONE=0]="NONE",e[e.PAGE=1]="PAGE",e[e.ALL=2]="ALL"}(Ee||(Ee={}));const ve=(0,u.style)({marginLeft:4}),be={[he.NAME]:{label:"Name",placeholder:"Filter by name"},[he.IS_ACTIVE]:{label:"Enabled",placeholder:"Filter by Enable status",options:{default:"all",exclude:["all"],exclusive:!0,items:[{value:"all",label:r.createElement(r.Fragment,null,"All")},{value:"Enabled",label:r.createElement(r.Fragment,null,r.createElement(R,null)," ",r.createElement("span",{className:ve},"Enabled"))},{value:"Disabled",label:r.createElement(r.Fragment,null,r.createElement(N,null)," ",r.createElement("span",{className:ve},"Disabled"))}]}}},fe=e=>{const{pageCount:t,count:i,page:n,perPage:o,showPerPageOptions:c,onPaginationChanged:d,onPaginationSizeChanged:u,onCreatePolicy:m,onDeletePolicy:g,hideActions:y,onSelectionChanged:h,selectedCount:E,hideBulkSelect:v,onEnablePolicy:b,onDisablePolicy:f,onExport:_}=e,T=(0,a.usePrimaryToolbarFilterConfig)(he,e.filters,e.setFilters,e.clearFilters,be),C=r.useMemo((()=>{if(v)return;const e=()=>h&&h(Ee.NONE),n=()=>h&&h(Ee.ALL);return{count:E||0,items:[{title:"Select none (0)",onClick:e},{title:`Select page (${t||0})`,onClick:()=>h&&h(Ee.PAGE)},{title:`Select all (${i||0})`,onClick:n}],checked:E===i,onSelect:t=>t?n():e()}}),[E,t,h,v,i]),P=r.useMemo((()=>({itemCount:i||0,page:n,perPage:o,perPageOptions:c?void 0:[],onSetPage:d,onFirstClick:d,onPreviousClick:d,onNextClick:d,onLastClick:d,onPageInput:d,onPerPageSelect:u,isCompact:!0,variant:s.PaginationVariant.top})),[c,i,n,o,d,u]),S=r.useMemo((()=>({itemCount:i||0,page:n,perPage:o,perPageOptions:c?void 0:[],onSetPage:d,onFirstClick:d,onPreviousClick:d,onNextClick:d,onLastClick:d,onPageInput:d,onPerPageSelect:u,isCompact:!1,variant:s.PaginationVariant.bottom})),[c,i,n,o,d,u]),x=r.useMemo((()=>{if(!y)return{actions:[{key:"create-policy",label:"Create policy",onClick:m,props:{isDisabled:!m}},{key:"delete-policy",label:"Remove",onClick:g,props:{isDisabled:!(E&&g)}},{key:"enable-policy",label:"Enable",onClick:b,props:{isDisabled:!(E&&b)}},{key:"disable-policy",label:"Disable",onClick:f,props:{isDisabled:!(E&&f)}}],kebabToggleProps:{isDisabled:!1}}}),[m,g,E,y,f,b]),O=r.useMemo((()=>{if(_)return{extraItems:[],onSelect:_}}),[_]);return r.createElement("div",Object.assign({},p("Policy/DualToolbar",e)),r.createElement(l.PrimaryToolbar,{bulkSelect:C,filterConfig:T.filterConfig,pagination:P,actionsConfig:x,activeFiltersConfig:T.activeFiltersConfig,exportConfig:O}),e.children,e.showBottomPagination&&r.createElement(l.PrimaryToolbar,{pagination:S}))},_e="/api/policies/v1.0";const Te={appId:"policies",defaultElementsPerPage:20,apis:{version:"v1.0",urls:{base:_e,userSettings:{email:("/user-config/email-preference",`${_e}/user-config/email-preference`)}}},pages:{emailPreferences:()=>(0,a.localUrl)("/user-preferences/email",(0,a.getInsights)().chrome.isBeta()),notifications:()=>(0,a.localUrl)("/settings/notifications",(0,a.getInsights)().chrome.isBeta()),factsDocumentation:"https://access.redhat.com/documentation/en-us/red_hat_insights/2020-04/html/monitoring_and_reacting_to_configuration_changes_using_policies/appendix-policies#facts-and-functions"}},Ce=e=>(0,a.useUrlStateString)("name",e),Pe=e=>(0,a.useUrlStateExclusiveOptions)("enabled",["Enabled","Disabled",""],""),Se=e=>{switch(e){case he.NAME:return Ce;case he.IS_ACTIVE:return Pe;default:(0,P.vE)(e)}},xe=(e=250,t=!0)=>(0,a.useFilters)(he,e,t?Se:void 0),Oe=(e,t,i)=>{const[n,o]=r.useState(1),[l,s]=r.useState(t);return r.useEffect((()=>{o(1)}),[o,e]),{page:r.useMemo((()=>{const t=new a.Filter,r=(0,a.stringValue)(e[he.NAME]).trim(),o=(0,a.stringValue)(e[he.IS_ACTIVE]).trim();return""!==r&&t.and(he.NAME,a.Operator.ILIKE,`%${r}%`),""!==o&&t.and(he.IS_ACTIVE,a.Operator.BOOLEAN_IS,"Enabled"===o?"true":"false"),a.Page.of(n,l,t,i)}),[n,l,i,e]),changePage:r.useCallback(((e,t)=>{o(t)}),[o]),changeItemsPerPage:r.useCallback(((e,t)=>{o(1),s(t)}),[o,s])}};var Ne,Ie,Re=i(94782),we=i(70070),Ae=i(52890),ke=i(78558);!function(e){function t(){return ke.enum(["BOOLEAN","INT","LIST","STRING"])}function i(){return ke.object({ctime:ke.number().int().optional().nullable(),hostName:ke.string().optional().nullable(),id:ke.string().optional().nullable()}).nonstrict()}function n(){return ke.array(i())}function a(){return ke.array(l())}function r(){return ke.record(ke.string())}function o(){return ke.object({count:ke.number().int().optional().nullable()}).nonstrict()}function l(){return ke.object({actions:ke.string().optional().nullable(),conditions:ke.string(),ctime:ke.string().optional().nullable(),description:ke.string().optional().nullable(),id:s().optional().nullable(),isEnabled:ke.boolean().optional().nullable(),lastTriggered:ke.number().int().optional().nullable(),mtime:ke.string().optional().nullable(),name:ke.string()}).nonstrict()}function s(){return ke.string()}e.Fact=ke.object({id:ke.number().int().optional().nullable(),name:ke.string().optional().nullable(),type:t().optional().nullable()}).nonstrict(),e.FactType=t(),e.HistoryItem=i(),e.ListHistoryItem=n(),e.ListPolicy=a(),e.ListUUID=ke.array(ke.string()),e.MapStringString=r(),e.Meta=o(),e.Msg=ke.object({msg:ke.string().optional().nullable()}).nonstrict(),e.PagedResponseOfHistoryItem=ke.object({data:n().optional().nullable(),links:r().optional().nullable(),meta:o().optional().nullable()}).nonstrict(),e.PagedResponseOfPolicy=ke.object({data:a().optional().nullable(),links:r().optional().nullable(),meta:o().optional().nullable()}).nonstrict(),e.Policy=l(),e.UUID=s(),e.__Empty=ke.string().max(0).optional()}(Ne||(Ne={})),function(e){let t,i,n,a,r,o,l,s,c,d,u,p,m,g;!function(e){e.actionCreator=()=>(0,Ae.actionBuilder)("GET","/api/policies/v1.0/").queryParams({}).config({rules:[new we.ValidateRule(Ne.__Empty,"__Empty",404)]}).build()}(t=e.Get||(e.Get={})),function(e){const t=ke.array(Ne.Fact);e.actionCreator=()=>(0,Ae.actionBuilder)("GET","/api/policies/v1.0/facts").queryParams({}).config({rules:[new we.ValidateRule(t,"unknown",200)]}).build()}(i=e.GetFacts||(e.GetFacts={})),function(e){ke.enum(["equal","like","ilike","not_equal"]),ke.enum(["equal","like","ilike","not_equal"]),ke.string(),ke.enum(["true","false"]),ke.string(),ke.number().int(),ke.number().int(),ke.enum(["name","description","is_enabled","mtime"]),ke.enum(["asc","desc"]),e.actionCreator=e=>{const t={};return void 0!==e.filterOpDescription&&(t["filter:op[description]"]=e.filterOpDescription),void 0!==e.filterOpName&&(t["filter:op[name]"]=e.filterOpName),void 0!==e.filterDescription&&(t["filter[description]"]=e.filterDescription),void 0!==e.filterIsEnabled&&(t["filter[is_enabled]"]=e.filterIsEnabled),void 0!==e.filterName&&(t["filter[name]"]=e.filterName),void 0!==e.limit&&(t.limit=e.limit),void 0!==e.offset&&(t.offset=e.offset),void 0!==e.sortColumn&&(t.sortColumn=e.sortColumn),void 0!==e.sortDirection&&(t.sortDirection=e.sortDirection),(0,Ae.actionBuilder)("GET","/api/policies/v1.0/policies").queryParams(t).config({rules:[new we.ValidateRule(Ne.PagedResponseOfPolicy,"PagedResponseOfPolicy",200),new we.ValidateRule(Ne.__Empty,"__Empty",400),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.__Empty,"__Empty",404)]}).build()}}(n=e.GetPolicies||(e.GetPolicies={})),function(e){ke.boolean(),e.actionCreator=e=>{const t={};return void 0!==e.alsoStore&&(t.alsoStore=e.alsoStore),(0,Ae.actionBuilder)("POST","/api/policies/v1.0/policies").queryParams(t).data(e.body).config({rules:[new we.ValidateRule(Ne.__Empty,"__Empty",200),new we.ValidateRule(Ne.Policy,"Policy",201),new we.ValidateRule(Ne.Msg,"Msg",400),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.Msg,"Msg",409),new we.ValidateRule(Ne.__Empty,"__Empty",500)]}).build()}}(a=e.PostPolicies||(e.PostPolicies={})),function(e){ke.enum(["equal","like","ilike","not_equal"]),ke.enum(["equal","like","ilike","not_equal"]),ke.string(),ke.enum(["true","false"]),ke.string();const t=ke.array(Ne.UUID);e.actionCreator=e=>{const i={};return void 0!==e.filterOpDescription&&(i["filter:op[description]"]=e.filterOpDescription),void 0!==e.filterOpName&&(i["filter:op[name]"]=e.filterOpName),void 0!==e.filterDescription&&(i["filter[description]"]=e.filterDescription),void 0!==e.filterIsEnabled&&(i["filter[is_enabled]"]=e.filterIsEnabled),void 0!==e.filterName&&(i["filter[name]"]=e.filterName),(0,Ae.actionBuilder)("GET","/api/policies/v1.0/policies/ids").queryParams(i).config({rules:[new we.ValidateRule(t,"unknown",200),new we.ValidateRule(Ne.__Empty,"__Empty",400),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.__Empty,"__Empty",404)]}).build()}}(r=e.GetPoliciesIds||(e.GetPoliciesIds={})),function(e){const t=ke.array(Ne.UUID);e.actionCreator=e=>(0,Ae.actionBuilder)("DELETE","/api/policies/v1.0/policies/ids").queryParams({}).data(e.body).config({rules:[new we.ValidateRule(t,"unknown",200),new we.ValidateRule(Ne.__Empty,"__Empty",403)]}).build()}(o=e.DeletePoliciesIds||(e.DeletePoliciesIds={})),function(e){ke.boolean();const t=ke.array(Ne.UUID);e.actionCreator=e=>{const i={};return void 0!==e.enabled&&(i.enabled=e.enabled),(0,Ae.actionBuilder)("POST","/api/policies/v1.0/policies/ids/enabled").queryParams(i).data(e.body).config({rules:[new we.ValidateRule(t,"unknown",200),new we.ValidateRule(Ne.__Empty,"__Empty",403)]}).build()}}(l=e.PostPoliciesIdsEnabled||(e.PostPoliciesIdsEnabled={})),function(e){e.actionCreator=e=>(0,Ae.actionBuilder)("POST","/api/policies/v1.0/policies/validate").queryParams({}).data(e.body).config({rules:[new we.ValidateRule(Ne.Msg,"Msg",200),new we.ValidateRule(Ne.Msg,"Msg",400),new we.ValidateRule(Ne.__Empty,"__Empty",500)]}).build()}(s=e.PostPoliciesValidate||(e.PostPoliciesValidate={})),function(e){ke.string(),e.actionCreator=e=>{const t={};return void 0!==e.id&&(t.id=e.id),(0,Ae.actionBuilder)("POST","/api/policies/v1.0/policies/validate-name").queryParams(t).data(e.body).config({rules:[new we.ValidateRule(Ne.Msg,"Msg",200),new we.ValidateRule(Ne.Msg,"Msg",400),new we.ValidateRule(Ne.Msg,"Msg",403),new we.ValidateRule(Ne.__Empty,"__Empty",409),new we.ValidateRule(Ne.__Empty,"__Empty",500)]}).build()}}(c=e.PostPoliciesValidateName||(e.PostPoliciesValidateName={})),function(e){e.actionCreator=e=>{const t="/api/policies/v1.0/policies/{id}".replace("{id}",e.id.toString());return(0,Ae.actionBuilder)("GET",t).queryParams({}).config({rules:[new we.ValidateRule(Ne.Policy,"Policy",200),new we.ValidateRule(Ne.Msg,"Msg",403),new we.ValidateRule(Ne.__Empty,"__Empty",404)]}).build()}}(d=e.GetPoliciesById||(e.GetPoliciesById={})),function(e){e.actionCreator=e=>{const t="/api/policies/v1.0/policies/{id}".replace("{id}",e.id.toString());return(0,Ae.actionBuilder)("DELETE",t).queryParams({}).config({rules:[new we.ValidateRule(Ne.__Empty,"__Empty",200),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.__Empty,"__Empty",404)]}).build()}}(u=e.DeletePoliciesById||(e.DeletePoliciesById={})),function(e){ke.boolean(),e.actionCreator=e=>{const t="/api/policies/v1.0/policies/{id}/enabled".replace("{id}",e.id.toString()),i={};return void 0!==e.enabled&&(i.enabled=e.enabled),(0,Ae.actionBuilder)("POST",t).queryParams(i).config({rules:[new we.ValidateRule(Ne.__Empty,"__Empty",200),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.__Empty,"__Empty",404),new we.ValidateRule(Ne.__Empty,"__Empty",500)]}).build()}}(p=e.PostPoliciesByIdEnabled||(e.PostPoliciesByIdEnabled={})),function(e){ke.enum(["equal","not_equal","like"]),ke.enum(["equal","like","not_equal"]),ke.string(),ke.string(),ke.number().int(),ke.number().int(),ke.enum(["hostName","ctime"]),ke.enum(["asc","desc"]),e.actionCreator=e=>{const t="/api/policies/v1.0/policies/{id}/history/trigger".replace("{id}",e.id.toString()),i={};return void 0!==e.filterOpId&&(i["filter:op[id]"]=e.filterOpId),void 0!==e.filterOpName&&(i["filter:op[name]"]=e.filterOpName),void 0!==e.filterId&&(i["filter[id]"]=e.filterId),void 0!==e.filterName&&(i["filter[name]"]=e.filterName),void 0!==e.limit&&(i.limit=e.limit),void 0!==e.offset&&(i.offset=e.offset),void 0!==e.sortColumn&&(i.sortColumn=e.sortColumn),void 0!==e.sortDirection&&(i.sortDirection=e.sortDirection),(0,Ae.actionBuilder)("GET",t).queryParams(i).config({rules:[new we.ValidateRule(Ne.PagedResponseOfHistoryItem,"PagedResponseOfHistoryItem",200),new we.ValidateRule(Ne.__Empty,"__Empty",400),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.__Empty,"__Empty",404),new we.ValidateRule(Ne.__Empty,"__Empty",500)]}).build()}}(m=e.GetPoliciesByIdHistoryTrigger||(e.GetPoliciesByIdHistoryTrigger={})),function(e){ke.boolean(),e.actionCreator=e=>{const t="/api/policies/v1.0/policies/{policyId}".replace("{policyId}",e.policyId.toString()),i={};return void 0!==e.dry&&(i.dry=e.dry),(0,Ae.actionBuilder)("PUT",t).queryParams(i).data(e.body).config({rules:[new we.ValidateRule(Ne.Policy,"Policy",200),new we.ValidateRule(Ne.__Empty,"__Empty",400),new we.ValidateRule(Ne.__Empty,"__Empty",403),new we.ValidateRule(Ne.__Empty,"__Empty",404),new we.ValidateRule(Ne.Msg,"Msg",409)]}).build()}}(g=e.PutPoliciesByPolicyId||(e.PutPoliciesByPolicyId={}))}(Ie||(Ie={}));const Le=e=>Ie.GetPoliciesIds.actionCreator(e.toQuery()),De=new a.ImmutableContainerSet(void 0,a.ImmutableContainerSetMode.INCLUDE),Fe=new a.ImmutableContainerSet(void 0,a.ImmutableContainerSetMode.EXCLUDE),Me=(e,t,i,n)=>{const[o,l]=r.useState([]),[s,c]=r.useState(De),d=(0,_.Z)(e),{query:u,loading:p}=(0,Re.useParameterizedQuery)(Le),m=r.useCallback((()=>{c(De),l((e=>e.map((e=>Object.assign(Object.assign({},e),{isOpen:!1,isSelected:!1})))))}),[c]);r.useEffect((()=>{t||!e?l([]):e!==d&&l(null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{isOpen:!1,isSelected:s.contains(e.id)}))))}),[e,t,l,d,s]);const g=r.useCallback(((e,t,i)=>{l((n=>{const a=[...n];return a[t]=Object.assign(Object.assign({},e),{isOpen:i}),a}))}),[l]),y=r.useCallback((e=>{c((t=>t.remove(e)))}),[c]),h=r.useCallback(((e,t,i)=>{c((t=>i?t.add(e.id):t.remove(e.id))),l((n=>{const a=[...n];return a[t]=Object.assign(Object.assign({},e),{isSelected:i}),a}))}),[c]),E=r.useCallback((e=>{e===Ee.NONE?(c(De),l((e=>e.map((e=>Object.assign(Object.assign({},e),{isSelected:!1})))))):e===Ee.PAGE?(c((e=>e.addIterable(o.map((e=>e.id))))),l((e=>e.map((e=>Object.assign(Object.assign({},e),{isSelected:!0})))))):e===Ee.ALL?(c(Fe),l((e=>e.map((e=>Object.assign(Object.assign({},e),{isSelected:!0})))))):(0,P.vE)(e)}),[o]),v=r.useMemo((()=>s.size(i)),[s,i]),b=r.useCallback((()=>s.mode===a.ImmutableContainerSetMode.INCLUDE?Promise.resolve(s.values()):u(n).then((e=>{var t;if(e.error)throw e.errorObject;let i=[];if(200===(null===(t=e.payload)||void 0===t?void 0:t.status)){const t=new Set(e.payload.value);s.values().forEach((e=>{t.delete(e)})),i=t}return Array.from(i.values())}))),[u,n,s]);return{rows:o,onCollapse:g,onSelect:h,onSelectionChanged:E,selectionCount:v,clearSelection:m,getSelected:b,loadingSelected:p,selected:s,removeSelection:y}},Ve=()=>{const[e,t]=r.useState(),[i,n]=r.useState(0),a=r.useCallback((()=>{t(void 0),n(0)}),[n,t]);return{open:r.useCallback((e=>{"number"==typeof e?(t(void 0),n(e)):(t(e),n(1))}),[]),close:a,count:i,policy:e,isOpen:i>0}};var Be=i(42227),Ue=i(5717);const je=e=>e.map((e=>{if(!e||!e.type)return"";const t=`${e.type}`;switch(e.type){case y.NOTIFICATION:case y.EMAIL:break;default:(0,P.vE)(e.type)}return t})).join(";"),Ge=e=>{if(!e||""===e)return[];const t=[];for(const i of e.split(";")){const[e]=i.split(" ",2);if("webhook"!==e)switch(e){case y.NOTIFICATION:t.push({type:y.NOTIFICATION});break;case y.EMAIL:t.push({type:y.EMAIL});break;default:throw Error(`Unknown action.type=${e} found`)}}return t},ze=e=>{const{mtime:t,ctime:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i}(e,["mtime","ctime"]);return Object.assign(Object.assign({},n),{name:e.name||"",conditions:e.conditions||"",isEnabled:void 0!==e.isEnabled&&e.isEnabled,actions:e.actions?je(e.actions):""})},He=e=>Object.assign(Object.assign({},e),{id:e.id?e.id:"",description:e.description?e.description:"",isEnabled:!!e.isEnabled&&e.isEnabled,actions:Ge(e.actions),mtime:e.mtime?(0,Ue.Z)(e.mtime):new Date(Date.now()),ctime:e.ctime?(0,Ue.Z)(e.ctime):new Date(Date.now()),lastTriggered:e.lastTriggered?(0,Be.Z)(e.lastTriggered/1e3):void 0}),Qe=e=>Object.assign(Object.assign({},e),{name:`Copy of ${e.name.slice(0,150-"Copy of ".length)}`,mtime:void 0,lastTriggered:void 0,ctime:void 0,id:void 0}),qe=(0,we.validationResponseTransformer)((e=>{var t,i;return"PagedResponseOfPolicy"===e.type?(0,we.validatedResponse)(e.type,e.status,{data:(i=e.value,i.data?i.data.map(He):[]),count:(null===(t=e.value.meta)||void 0===t?void 0:t.count)||0},e.errors):e})),Ze=(e,t)=>(0,a.useTransformQueryResponse)((0,Re.useQuery)((e=>{var t;return Ie.GetPolicies.actionCreator(null!==(t=null==e?void 0:e.toQuery())&&void 0!==t?t:{})})(e),t),qe),$e=(0,we.validationResponseTransformer)((e=>{var t;let i=!0;return"PagedResponseOfPolicy"===e.type&&(i=!!(null===(t=e.value.data)||void 0===t?void 0:t.length)),(0,we.validatedResponse)("HasPolicies",e.status,i,e.errors)})),We=e=>Ie.PostPoliciesIdsEnabled.actionCreator({body:e.policyIds,enabled:e.shouldBeEnabled}),Ke=()=>(0,Re.useMutation)(We);var Ye=i(74322),Xe=i(52258),Je=i(84956),et=i(53209);const tt=et.Ry().shape({type:et.nK().oneOf([y.EMAIL]).required()}),it=et.Ry().shape({type:et.nK().oneOf([y.NOTIFICATION]).required()}),nt=et.Ry().shape({type:et.nK().required("Specify the action type").oneOf(Object.values(y))}),at=(e,t,i)=>{const n=`Only one ${t} action is allowed`;return[`one-${i}`,n,t=>{const a=t&&t.reduce(((t,i,n)=>(null==i?void 0:i.type)===e?t.concat([n]):t),[]);if(!a||a.length<=1)return!0;const r=new et.p8("","","actions","");return r.inner=a.map((e=>new et.p8(n,i,`actions.${e}.type`))),r}]},rt=et.Ry().shape({description:et.Z_().notRequired().trim(),isEnabled:et.O7().notRequired(),name:et.Z_().required("Write a name for this Policy").max(150).trim()}),ot=et.Ry().shape({actions:et.IX(et.Vo((e=>{if((null==e?void 0:e.type)&&((t=e).type===y.EMAIL||t.type===y.NOTIFICATION)){const t=e.type;switch(t){case y.EMAIL:return tt;case y.NOTIFICATION:return it;default:(0,P.vE)(t)}}var t;return nt}))).test(...at(y.EMAIL,"Email","email")).test(...at(y.NOTIFICATION,"Hook","notification"))}),lt=et.Ry().shape({conditions:et.Z_().required("Enter a condition for the policy.").trim()}),st=et.Ry().concat(rt).concat(ot).concat(lt);var ct,dt=i(84564),ut=i(7193);et.Ry(),function(e){e.SAVE="CREATE",e.VALIDATE_CONDITION="VALIDATE_CONDITION",e.VALIDATE_NAME="VALIDATE_NAME",e.NONE="NONE"}(ct||(ct={}));const pt=r.createContext({isLoading:!1,isFormValid:!1,triggerAction:()=>{throw Error("Action executed without WizardContext")},verifyResponse:{isValid:!1},createResponse:{created:!1},setVerifyResponse:()=>{throw Error("setVerifyResponse executed without WizardContext")},setMaxStep:()=>{throw Error("setMaxStep executed without a WizardContext")}}),mt=(0,u.style)({marginTop:"auto",marginBottom:14}),gt=(0,u.style)({marginRight:5}),yt=e=>{const t=(0,r.useContext)(pt);return r.createElement(s.WizardFooter,null,r.createElement(s.WizardContextConsumer,null,(i=>{const n=e.onNext&&(()=>{e.onNext&&e.onNext(t,i.onNext)});return r.createElement(r.Fragment,null,r.createElement(s.Button,{variant:s.ButtonVariant.primary,type:"submit",onClick:n||i.onNext,isDisabled:e.isLoading||!i.activeStep.enableNext},i.activeStep.nextButtonText||"Next"),!i.activeStep.hideBackButton&&r.createElement(s.Button,{variant:s.ButtonVariant.secondary,onClick:i.onBack,isDisabled:0===i.activeStep.id||e.isLoading},"Back"),!i.activeStep.hideCancelButton&&r.createElement(s.Button,{variant:s.ButtonVariant.link,onClick:i.onClose,isDisabled:e.isLoading},"Cancel"),e.isLoading&&r.createElement("div",{className:mt},e.loadingText," Â ",r.createElement(s.Spinner,{size:"md"})),!e.isLoading&&e.error&&r.createElement(s.Split,{className:mt},r.createElement(s.SplitItem,null,r.createElement(dt.ZP,{className:gt,color:ut.ZP.value})),r.createElement(s.SplitItem,null,e.error)))})))};var ht=i(33606),Et=i(32412);const vt=e=>{const t=(0,r.useContext)(T);return r.createElement("div",Object.assign({},p("Policy/Action/Email",e)),r.createElement(s.Text,null,"An email will be sent to all users on this account with access to Policies according to their email preferences."),!t.userSettings.isSubscribedForNotifications&&r.createElement(a.InsightsEmailOptIn,{ouiaId:"action-email.wizard-email-required",content:h.wizards.policy.actions.emailOptIn,insights:(0,a.getInsights)()}))},bt=e=>r.createElement(s.Text,null,e.head,r.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer"},e.link),e.tail),ft=e=>{const t=r.useMemo((()=>Te.pages.notifications()),[]);return r.createElement("div",Object.assign({},p("Policy/Action/Hook",e)),r.createElement(bt,Object.assign({},h.components.actionNotificationForm.paragraph1,{url:t})),r.createElement(bt,Object.assign({},h.components.actionNotificationForm.paragraph2,{url:t})))},_t=e=>{var t,i;switch((null===(t=e.action)||void 0===t?void 0:t.type)||void 0){case y.EMAIL:return r.createElement(vt,Object.assign({},e));case y.NOTIFICATION:return r.createElement(ft,Object.assign({},e));case void 0:return null;default:throw new Error("Unexpected action type:["+(null===(i=e.action)||void 0===i?void 0:i.type)+"]")}},Tt=(0,u.style)({gridGap:Et.ZP.var}),Ct=(0,u.style)({backgroundColor:"white",border:"1px var(--pf-global--BorderColor--200) solid",boxShadow:"none"}),Pt=(0,u.style)({marginLeft:10,display:"inline"}),St=e=>{var t;return r.createElement(s.Form,{className:Tt},null===(t=e.actions)||void 0===t?void 0:t.map(((t,i)=>r.createElement(r.Fragment,{key:i},r.createElement(s.Card,{className:Ct},r.createElement(s.CardHeader,{"data-codemods":"true"},r.createElement(s.CardActions,null,r.createElement(s.Button,{variant:"plain","aria-label":"Action",onClick:e.arrayHelpers.handleRemove(i)},r.createElement(ht.ZP,null))),r.createElement(s.CardTitle,null,r.createElement(r.Fragment,null,r.createElement(L,{actionType:null==t?void 0:t.type}),r.createElement(s.Title,{headingLevel:"h2",className:Pt,size:"md"},(null==t?void 0:t.type)?(e=>{switch(e){case y.EMAIL:return h.tables.policy.actions.email;case y.NOTIFICATION:return h.tables.policy.actions.notification;default:(0,P.vE)(e)}})(t.type):"")))),r.createElement(s.CardBody,{className:"pf-c-form"},r.createElement(_t,{ouiaId:`actions-form.${i.toString()}`,isReadOnly:e.isReadOnly,action:t,prefix:`actions.${i}`})))))))};var xt=i(75902),Ot=i(81875);const Nt=(0,u.style)({marginBottom:16}),It=e=>{const[t,i]=r.useState(!1),n=[(0,a.getInsights)().chrome.isBeta()?y.NOTIFICATION:y.EMAIL].map((t=>r.createElement(s.DropdownItem,{key:t,onClick:()=>(t=>{e.onTypeSelected(t),i(!1)})(t),isDisabled:!e.isTypeEnabled(t)},h.components.actionType[t])));return r.createElement(s.Dropdown,Object.assign({isOpen:t,dropdownItems:n,isPlain:!0,className:Nt,toggle:r.createElement(xt.Z,{isPlain:!0,onToggle:e=>i(e),id:"add-action-toggle"},r.createElement(s.Button,{component:"a",variant:s.ButtonVariant.link,isInline:!0}," Add trigger actions ",r.createElement(Ot.ZP,null)," "))},p("Policy/Wizard/AddTrigger",e)))},Rt=()=>{var e;const{validateForm:t,values:i}=(0,Xe.useFormikContext)(),n=null===(e=i.actions)||void 0===e?void 0:e.length;return r.useEffect((()=>{t()}),[t,n]),r.createElement(r.Fragment,null,r.createElement(s.Title,{headingLevel:"h4",size:"xl"},h.wizards.policy.actions.title),r.createElement(Xe.FieldArray,{name:"actions"},(e=>r.createElement(r.Fragment,null,r.createElement(It,{isTypeEnabled:t=>{var i;return 0===((null===(i=e.form.values.actions)||void 0===i?void 0:i.filter((e=>e.type===t)))||[]).length},onTypeSelected:t=>{e.push({type:t})}}),r.createElement(St,{id:"actions",name:"actions",actions:e.form.values.actions,arrayHelpers:e})))))};var wt=i(47561),At=i(48286),kt=i(18127),Lt=i(50352),Dt=i(9963),Ft=i(39557),Mt=i(62178),Vt=i(36763),Bt=i(15103);class Ut extends Ft.Lexer{constructor(e){super(e),this._interp=new Mt.LexerATNSimulator(Ut._ATN,this)}get vocabulary(){return Ut.VOCABULARY}get grammarFileName(){return"Expression.g4"}get ruleNames(){return Ut.ruleNames}get serializedATN(){return Ut._serializedATN}get channelNames(){return Ut.channelNames}get modeNames(){return Ut.modeNames}static get _ATN(){return Ut.__ATN||(Ut.__ATN=(new Dt.ATNDeserializer).deserialize(Bt.toCharArray(Ut._serializedATN))),Ut.__ATN}}Ut.T__0=1,Ut.T__1=2,Ut.T__2=3,Ut.T__3=4,Ut.T__4=5,Ut.OR=6,Ut.AND=7,Ut.NOT=8,Ut.EQUAL=9,Ut.NOTEQUAL=10,Ut.CONTAINS=11,Ut.MATCHES=12,Ut.NEG=13,Ut.GT=14,Ut.GTE=15,Ut.LT=16,Ut.LTE=17,Ut.IN=18,Ut.QUOTED_NUMBER=19,Ut.NUMBER=20,Ut.FLOAT=21,Ut.INTEGER=22,Ut.SIMPLETEXT=23,Ut.STRING=24,Ut.WS=25,Ut.channelNames=["DEFAULT_TOKEN_CHANNEL","HIDDEN"],Ut.modeNames=["DEFAULT_MODE"],Ut.ruleNames=["T__0","T__1","T__2","T__3","T__4","OR","AND","NOT","EQUAL","NOTEQUAL","CONTAINS","MATCHES","NEG","GT","GTE","LT","LTE","IN","QUOTED_NUMBER","NUMBER","FLOAT","INTEGER","SIMPLETEXT","STRING","WS","ESC","UNICODE","HEX","ESC_DOT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","NEG_OP"],Ut._LITERAL_NAMES=[void 0,"'('","')'","'['","','","']'",void 0,void 0,void 0,"'='","'!='",void 0,void 0,void 0,"'>'","'>='","'<'","'<='"],Ut._SYMBOLIC_NAMES=[void 0,void 0,void 0,void 0,void 0,void 0,"OR","AND","NOT","EQUAL","NOTEQUAL","CONTAINS","MATCHES","NEG","GT","GTE","LT","LTE","IN","QUOTED_NUMBER","NUMBER","FLOAT","INTEGER","SIMPLETEXT","STRING","WS"],Ut.VOCABULARY=new Vt.VocabularyImpl(Ut._LITERAL_NAMES,Ut._SYMBOLIC_NAMES,[]),Ut._serializedATN="ì¤ìªºÖê¾ºä½“Ø‡îª‹ì‰Ä¯\b\t\t\t\t\t\t\b\t\b\t\t\t\n\t\n\v\t\v\f\t\f\r\t\r\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t !\t!\"\t\"#\t#$\t$%\t%&\t&'\t'(\t()\t)*\t*+\t+,\t,-\t-.\t./\t/0\t01\t12\t23\t34\t45\t56\t67\t78\t89\t9\b\b\b\b\t\t\t\t\n\n\v\v\v\f\f\f\f\f\f\f\f\f\r\r\r\r\r\r\r\rÂ¶\nÂ»\nÃ‚\n\rÃƒÃ‰\n\fÃŒ\vÃ‘\n\fÃ”\vÃš\n\fÃ\vÃ \nÃ£\n\rÃ¤Ã­\n  !!\"\"##$$%%&&''(())**++,,--..//00112233445566778899:\t\v\r\b\t\n\v\f\r!#%')+-/13579;=?ACEGIKMOQSUWY[]_acegikmoq$2;002;C\\aac|/02;C\\aac|))^^$$^^\v\f\"\"\n))11^^ddhhppttvv2;CHchCCccDDddEEeeFFffGGggHHhhIIiiJJjjKKkkLLllMMmmNNnnOOooPPppQQqqRRrrSSssTTttUUuuVVvvWWwwXXxxYYyyZZzz[[{{\\\\||Äœ\t\v\r!#%')+-/13suw\ty\v{\r}Â€Â„ÂˆÂŠÂÂ–ÂÂ Â¢!Â¥#Â§%Âª'Âµ)Â·+Â¼-Ã/Ã…1ÃŸ3Ã¢5Ã¨7Ã®9Ã´;Ã¶=Ã¹?Ã»AÃ½CÃ¿EÄGÄƒIÄ…KÄ‡MÄ‰OÄ‹QÄSÄUÄ‘WÄ“YÄ•[Ä—]Ä™_Ä›aÄcÄŸeÄ¡gÄ£iÄ¥kÄ§mÄ©oÄ«qÄ­st*tuv+vwx]x\byz.z\n{|_|\f}~Y-~_0Â€Â=ÂÂ‚W,Â‚ÂƒC\"ÂƒÂ„Â…W,Â…Â†Y-Â†Â‡c2Â‡ÂˆÂ‰?Â‰ÂŠÂ‹#Â‹ÂŒ?ÂŒÂÂA!ÂÂY-ÂÂW,ÂÂ‘c2Â‘Â’=Â’Â“M'Â“Â”W,Â”Â•a1Â•Â–Â—U+Â—Â˜=Â˜Â™c2Â™ÂšA!ÂšÂ›K&Â›ÂœE#ÂœÂa1ÂÂÂŸq9ÂŸÂ Â¡@Â¡Â¢Â£@Â£Â¤?Â¤ Â¥Â¦>Â¦\"Â§Â¨>Â¨Â©?Â©$ÂªÂ«M'Â«Â¬W,Â¬&Â­Â®)Â®Â¯)Â¯Â°)Â°Â¶Â±Â²$Â²Â³)Â³Â´$Â´Â¶ÂµÂ­ÂµÂ±Â¶(Â·Âº-Â¸Â¹0Â¹Â»-ÂºÂ¸ÂºÂ»Â»*Â¼Â½-Â½Â¾0Â¾Â¿-Â¿,Ã€Ã‚\tÃÃ€Ã‚ÃƒÃƒÃÃƒÃ„Ã„.Ã…ÃŠ\tÃ†Ã‰\tÃ‡Ã‰;ÃˆÃ†ÃˆÃ‡Ã‰ÃŒÃŠÃˆÃŠÃ‹Ã‹0ÃŒÃŠÃÃ’)ÃÃ‘5ÃÃ‘\nÃÃÃÃÃ‘Ã”Ã’ÃÃ’Ã“Ã“Ã•Ã”Ã’Ã•Ã )Ã–Ã›$Ã—Ãš5Ã˜Ãš\nÃ™Ã—Ã™Ã˜ÃšÃÃ›Ã™Ã›ÃœÃœÃÃÃ›ÃÃ $ÃŸÃÃŸÃ–Ã 2Ã¡Ã£\tÃ¢Ã¡Ã£Ã¤Ã¤Ã¢Ã¤Ã¥Ã¥Ã¦Ã¦Ã§\bÃ§4Ã¨Ã¬^Ã©Ã­\t\bÃªÃ­7Ã«Ã­q9Ã¬Ã©Ã¬ÃªÃ¬Ã«Ã­6Ã®Ã¯wÃ¯Ã°9Ã°Ã±9Ã±Ã²9Ã²Ã³9Ã³8Ã´Ãµ\t\tÃµ:Ã¶Ã·^Ã·Ã¸0Ã¸<Ã¹Ãº\t\nÃº>Ã»Ã¼\t\vÃ¼@Ã½Ã¾\t\fÃ¾BÃ¿Ä€\t\rÄ€DÄÄ‚\tÄ‚FÄƒÄ„\tÄ„HÄ…Ä†\tÄ†JÄ‡Äˆ\tÄˆLÄ‰ÄŠ\tÄŠNÄ‹ÄŒ\tÄŒPÄÄ\tÄRÄÄ\tÄTÄ‘Ä’\tÄ’VÄ“Ä”\tÄ”XÄ•Ä–\tÄ–ZÄ—Ä˜\tÄ˜\\Ä™Äš\tÄš^Ä›Äœ\tÄœ`ÄÄ\tÄbÄŸÄ \tÄ dÄ¡Ä¢\tÄ¢fÄ£Ä¤\tÄ¤hÄ¥Ä¦\t Ä¦jÄ§Ä¨\t!Ä¨lÄ©Äª\t\"ÄªnÄ«Ä¬\t#Ä¬pÄ­Ä®#Ä®rÂµÂºÃƒÃˆÃŠÃÃ’Ã™Ã›ÃŸÃ¤Ã¬\b";var jt=i(87949),Gt=i(32915),zt=i(94609),Ht=i(2824),Qt=i(83208),qt=i(4584),Zt=i(3998),$t=i(44966);class Wt extends Ht.Parser{constructor(e){super(e),this._interp=new qt.ParserATNSimulator(Wt._ATN,this)}get vocabulary(){return Wt.VOCABULARY}get grammarFileName(){return"Expression.g4"}get ruleNames(){return Wt.ruleNames}get serializedATN(){return Wt._serializedATN}expression(){let e=new Kt(this._ctx,this.state);this.enterRule(e,0,Wt.RULE_expression);try{this.enterOuterAlt(e,1),this.state=26,this.object(0),this.state=27,this.match(Wt.EOF)}catch(t){if(!(t instanceof Zt.RecognitionException))throw t;e.exception=t,this._errHandler.reportError(this,t),this._errHandler.recover(this,t)}finally{this.exitRule()}return e}object(e){void 0===e&&(e=0);let t=this._ctx,i=this.state,n=new Yt(this._ctx,i),a=n;this.enterRecursionRule(n,2,Wt.RULE_object,e);try{let e;switch(this.enterOuterAlt(n,1),this.state=38,this._errHandler.sync(this),this._input.LA(1)){case Wt.NOT:case Wt.NEG:this.state=30,this.negative_expr(),this.state=31,this.object(4);break;case Wt.SIMPLETEXT:case Wt.STRING:this.state=33,this.expr();break;case Wt.T__0:this.state=34,this.match(Wt.T__0),this.state=35,this.object(0),this.state=36,this.match(Wt.T__1);break;default:throw new zt.NoViableAltException(this)}for(this._ctx._stop=this._input.tryLT(-1),this.state=46,this._errHandler.sync(this),e=this.interpreter.adaptivePredict(this._input,1,this._ctx);2!==e&&e!==jt.ATN.INVALID_ALT_NUMBER;){if(1===e){if(null!=this._parseListeners&&this.triggerExitRuleEvent(),a=n,n=new Yt(t,i),this.pushNewRecursionContext(n,2,Wt.RULE_object),this.state=40,!this.precpred(this._ctx,1))throw new Gt.FailedPredicateException(this,"this.precpred(this._ctx, 1)");this.state=41,this.logical_operator(),this.state=42,this.object(2)}this.state=48,this._errHandler.sync(this),e=this.interpreter.adaptivePredict(this._input,1,this._ctx)}}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;n.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.unrollRecursionContexts(t)}return n}expr(){let e=new Xt(this._ctx,this.state);this.enterRule(e,4,Wt.RULE_expr);try{switch(this.state=70,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,2,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=49,this.key();break;case 2:this.enterOuterAlt(e,2),this.state=50,this.key(),this.state=51,this.boolean_operator(),this.state=52,this.value();break;case 3:this.enterOuterAlt(e,3),this.state=54,this.key(),this.state=55,this.numeric_compare_operator(),this.state=56,this.numerical_value();break;case 4:this.enterOuterAlt(e,4),this.state=58,this.key(),this.state=59,this.string_compare_operator(),this.state=60,this.array();break;case 5:this.enterOuterAlt(e,5),this.state=62,this.key(),this.state=63,this.string_compare_operator(),this.state=64,this.value();break;case 6:this.enterOuterAlt(e,6),this.state=66,this.key(),this.state=67,this.array_operator(),this.state=68,this.array()}}catch(t){if(!(t instanceof Zt.RecognitionException))throw t;e.exception=t,this._errHandler.reportError(this,t),this._errHandler.recover(this,t)}finally{this.exitRule()}return e}logical_operator(){let e,t=new Jt(this._ctx,this.state);this.enterRule(t,6,Wt.RULE_logical_operator);try{this.enterOuterAlt(t,1),this.state=72,e=this._input.LA(1),e!==Wt.OR&&e!==Wt.AND?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}boolean_operator(){let e,t=new ei(this._ctx,this.state);this.enterRule(t,8,Wt.RULE_boolean_operator);try{this.enterOuterAlt(t,1),this.state=74,e=this._input.LA(1),e!==Wt.EQUAL&&e!==Wt.NOTEQUAL?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}numeric_compare_operator(){let e,t=new ti(this._ctx,this.state);this.enterRule(t,10,Wt.RULE_numeric_compare_operator);try{this.enterOuterAlt(t,1),this.state=76,e=this._input.LA(1),0!=(-32&e)||0==(1<<e&(1<<Wt.GT|1<<Wt.GTE|1<<Wt.LT|1<<Wt.LTE))?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}string_compare_operator(){let e,t=new ii(this._ctx,this.state);this.enterRule(t,12,Wt.RULE_string_compare_operator);try{this.enterOuterAlt(t,1),this.state=78,e=this._input.LA(1),e!==Wt.CONTAINS&&e!==Wt.MATCHES?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}array_operator(){let e,t=new ni(this._ctx,this.state);this.enterRule(t,14,Wt.RULE_array_operator);try{this.enterOuterAlt(t,1),this.state=80,e=this._input.LA(1),e!==Wt.CONTAINS&&e!==Wt.IN?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}array(){let e,t=new ai(this._ctx,this.state);this.enterRule(t,16,Wt.RULE_array);try{switch(this.state=95,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,4,this._ctx)){case 1:for(this.enterOuterAlt(t,1),this.state=82,this.match(Wt.T__2),this.state=83,this.value(),this.state=88,this._errHandler.sync(this),e=this._input.LA(1);e===Wt.T__3;)this.state=84,this.match(Wt.T__3),this.state=85,this.value(),this.state=90,this._errHandler.sync(this),e=this._input.LA(1);this.state=91,this.match(Wt.T__4);break;case 2:this.enterOuterAlt(t,2),this.state=93,this.match(Wt.T__2),this.state=94,this.match(Wt.T__4)}}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}numerical_value(){let e,t=new ri(this._ctx,this.state);this.enterRule(t,18,Wt.RULE_numerical_value);try{this.enterOuterAlt(t,1),this.state=97,e=this._input.LA(1),e!==Wt.QUOTED_NUMBER&&e!==Wt.NUMBER?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}value(){let e,t=new oi(this._ctx,this.state);this.enterRule(t,20,Wt.RULE_value);try{this.enterOuterAlt(t,1),this.state=99,e=this._input.LA(1),0!=(-32&e)||0==(1<<e&(1<<Wt.QUOTED_NUMBER|1<<Wt.NUMBER|1<<Wt.STRING))?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}negative_expr(){let e,t=new li(this._ctx,this.state);this.enterRule(t,22,Wt.RULE_negative_expr);try{this.enterOuterAlt(t,1),this.state=101,e=this._input.LA(1),e!==Wt.NOT&&e!==Wt.NEG?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}key(){let e,t=new si(this._ctx,this.state);this.enterRule(t,24,Wt.RULE_key);try{this.enterOuterAlt(t,1),this.state=103,e=this._input.LA(1),e!==Wt.SIMPLETEXT&&e!==Wt.STRING?this._errHandler.recoverInline(this):(this._input.LA(1)===$t.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume())}catch(e){if(!(e instanceof Zt.RecognitionException))throw e;t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e)}finally{this.exitRule()}return t}sempred(e,t,i){switch(t){case 1:return this.object_sempred(e,i)}return!0}object_sempred(e,t){switch(t){case 0:return this.precpred(this._ctx,1)}return!0}static get _ATN(){return Wt.__ATN||(Wt.__ATN=(new Dt.ATNDeserializer).deserialize(Bt.toCharArray(Wt._serializedATN))),Wt.__ATN}}Wt.T__0=1,Wt.T__1=2,Wt.T__2=3,Wt.T__3=4,Wt.T__4=5,Wt.OR=6,Wt.AND=7,Wt.NOT=8,Wt.EQUAL=9,Wt.NOTEQUAL=10,Wt.CONTAINS=11,Wt.MATCHES=12,Wt.NEG=13,Wt.GT=14,Wt.GTE=15,Wt.LT=16,Wt.LTE=17,Wt.IN=18,Wt.QUOTED_NUMBER=19,Wt.NUMBER=20,Wt.FLOAT=21,Wt.INTEGER=22,Wt.SIMPLETEXT=23,Wt.STRING=24,Wt.WS=25,Wt.RULE_expression=0,Wt.RULE_object=1,Wt.RULE_expr=2,Wt.RULE_logical_operator=3,Wt.RULE_boolean_operator=4,Wt.RULE_numeric_compare_operator=5,Wt.RULE_string_compare_operator=6,Wt.RULE_array_operator=7,Wt.RULE_array=8,Wt.RULE_numerical_value=9,Wt.RULE_value=10,Wt.RULE_negative_expr=11,Wt.RULE_key=12,Wt.ruleNames=["expression","object","expr","logical_operator","boolean_operator","numeric_compare_operator","string_compare_operator","array_operator","array","numerical_value","value","negative_expr","key"],Wt._LITERAL_NAMES=[void 0,"'('","')'","'['","','","']'",void 0,void 0,void 0,"'='","'!='",void 0,void 0,void 0,"'>'","'>='","'<'","'<='"],Wt._SYMBOLIC_NAMES=[void 0,void 0,void 0,void 0,void 0,void 0,"OR","AND","NOT","EQUAL","NOTEQUAL","CONTAINS","MATCHES","NEG","GT","GTE","LT","LTE","IN","QUOTED_NUMBER","NUMBER","FLOAT","INTEGER","SIMPLETEXT","STRING","WS"],Wt.VOCABULARY=new Vt.VocabularyImpl(Wt._LITERAL_NAMES,Wt._SYMBOLIC_NAMES,[]),Wt._serializedATN="ì¤ìªºÖê¾ºä½“Ø‡îª‹ì‰l\t\t\t\t\t\t\b\t\b\t\t\t\n\t\n\v\t\v\f\t\f\r\t\r\t)\n/\n\f2\vI\n\b\b\t\t\n\n\n\n\nY\n\n\f\n\n\\\v\n\n\n\n\n\nb\n\n\v\v\f\f\r\r\b\n\f\v\b\t\v\f\r\r\r\n\nh(H\bJ\nL\fNPRacegi \b !\r!\"\")#)$%%&&'')((#($)0*+\f+,\b,--/.*/20.011203I4556\n67\f7I899:\f:;\v;I<==>\b>?\n?I@AAB\bBC\fCIDEEF\tFG\nGIH3H4H8H<H@HDIJK\tK\tLM\tM\vNO\tO\rPQ\tQRS\tSTUUZ\fVWWY\fXVY\\ZXZ[[]\\Z]^^b_``baTa_bcd\tdef\t\bfgh\t\thij\t\nj(0HZa";class Kt extends Qt.ParserRuleContext{object(){return this.getRuleContext(0,Yt)}EOF(){return this.getToken(Wt.EOF,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_expression}enterRule(e){e.enterExpression&&e.enterExpression(this)}exitRule(e){e.exitExpression&&e.exitExpression(this)}accept(e){return e.visitExpression?e.visitExpression(this):e.visitChildren(this)}}class Yt extends Qt.ParserRuleContext{negative_expr(){return this.tryGetRuleContext(0,li)}object(e){return void 0===e?this.getRuleContexts(Yt):this.getRuleContext(e,Yt)}expr(){return this.tryGetRuleContext(0,Xt)}logical_operator(){return this.tryGetRuleContext(0,Jt)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_object}enterRule(e){e.enterObject&&e.enterObject(this)}exitRule(e){e.exitObject&&e.exitObject(this)}accept(e){return e.visitObject?e.visitObject(this):e.visitChildren(this)}}class Xt extends Qt.ParserRuleContext{key(){return this.getRuleContext(0,si)}boolean_operator(){return this.tryGetRuleContext(0,ei)}value(){return this.tryGetRuleContext(0,oi)}numeric_compare_operator(){return this.tryGetRuleContext(0,ti)}numerical_value(){return this.tryGetRuleContext(0,ri)}string_compare_operator(){return this.tryGetRuleContext(0,ii)}array(){return this.tryGetRuleContext(0,ai)}array_operator(){return this.tryGetRuleContext(0,ni)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_expr}enterRule(e){e.enterExpr&&e.enterExpr(this)}exitRule(e){e.exitExpr&&e.exitExpr(this)}accept(e){return e.visitExpr?e.visitExpr(this):e.visitChildren(this)}}class Jt extends Qt.ParserRuleContext{AND(){return this.tryGetToken(Wt.AND,0)}OR(){return this.tryGetToken(Wt.OR,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_logical_operator}enterRule(e){e.enterLogical_operator&&e.enterLogical_operator(this)}exitRule(e){e.exitLogical_operator&&e.exitLogical_operator(this)}accept(e){return e.visitLogical_operator?e.visitLogical_operator(this):e.visitChildren(this)}}class ei extends Qt.ParserRuleContext{EQUAL(){return this.tryGetToken(Wt.EQUAL,0)}NOTEQUAL(){return this.tryGetToken(Wt.NOTEQUAL,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_boolean_operator}enterRule(e){e.enterBoolean_operator&&e.enterBoolean_operator(this)}exitRule(e){e.exitBoolean_operator&&e.exitBoolean_operator(this)}accept(e){return e.visitBoolean_operator?e.visitBoolean_operator(this):e.visitChildren(this)}}class ti extends Qt.ParserRuleContext{GT(){return this.tryGetToken(Wt.GT,0)}GTE(){return this.tryGetToken(Wt.GTE,0)}LT(){return this.tryGetToken(Wt.LT,0)}LTE(){return this.tryGetToken(Wt.LTE,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_numeric_compare_operator}enterRule(e){e.enterNumeric_compare_operator&&e.enterNumeric_compare_operator(this)}exitRule(e){e.exitNumeric_compare_operator&&e.exitNumeric_compare_operator(this)}accept(e){return e.visitNumeric_compare_operator?e.visitNumeric_compare_operator(this):e.visitChildren(this)}}class ii extends Qt.ParserRuleContext{CONTAINS(){return this.tryGetToken(Wt.CONTAINS,0)}MATCHES(){return this.tryGetToken(Wt.MATCHES,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_string_compare_operator}enterRule(e){e.enterString_compare_operator&&e.enterString_compare_operator(this)}exitRule(e){e.exitString_compare_operator&&e.exitString_compare_operator(this)}accept(e){return e.visitString_compare_operator?e.visitString_compare_operator(this):e.visitChildren(this)}}class ni extends Qt.ParserRuleContext{IN(){return this.tryGetToken(Wt.IN,0)}CONTAINS(){return this.tryGetToken(Wt.CONTAINS,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_array_operator}enterRule(e){e.enterArray_operator&&e.enterArray_operator(this)}exitRule(e){e.exitArray_operator&&e.exitArray_operator(this)}accept(e){return e.visitArray_operator?e.visitArray_operator(this):e.visitChildren(this)}}class ai extends Qt.ParserRuleContext{value(e){return void 0===e?this.getRuleContexts(oi):this.getRuleContext(e,oi)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_array}enterRule(e){e.enterArray&&e.enterArray(this)}exitRule(e){e.exitArray&&e.exitArray(this)}accept(e){return e.visitArray?e.visitArray(this):e.visitChildren(this)}}class ri extends Qt.ParserRuleContext{NUMBER(){return this.tryGetToken(Wt.NUMBER,0)}QUOTED_NUMBER(){return this.tryGetToken(Wt.QUOTED_NUMBER,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_numerical_value}enterRule(e){e.enterNumerical_value&&e.enterNumerical_value(this)}exitRule(e){e.exitNumerical_value&&e.exitNumerical_value(this)}accept(e){return e.visitNumerical_value?e.visitNumerical_value(this):e.visitChildren(this)}}class oi extends Qt.ParserRuleContext{NUMBER(){return this.tryGetToken(Wt.NUMBER,0)}QUOTED_NUMBER(){return this.tryGetToken(Wt.QUOTED_NUMBER,0)}STRING(){return this.tryGetToken(Wt.STRING,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_value}enterRule(e){e.enterValue&&e.enterValue(this)}exitRule(e){e.exitValue&&e.exitValue(this)}accept(e){return e.visitValue?e.visitValue(this):e.visitChildren(this)}}class li extends Qt.ParserRuleContext{NEG(){return this.tryGetToken(Wt.NEG,0)}NOT(){return this.tryGetToken(Wt.NOT,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_negative_expr}enterRule(e){e.enterNegative_expr&&e.enterNegative_expr(this)}exitRule(e){e.exitNegative_expr&&e.exitNegative_expr(this)}accept(e){return e.visitNegative_expr?e.visitNegative_expr(this):e.visitChildren(this)}}class si extends Qt.ParserRuleContext{SIMPLETEXT(){return this.tryGetToken(Wt.SIMPLETEXT,0)}STRING(){return this.tryGetToken(Wt.STRING,0)}constructor(e,t){super(e,t)}get ruleIndex(){return Wt.RULE_key}enterRule(e){e.enterKey&&e.enterKey(this)}exitRule(e){e.exitKey&&e.exitKey(this)}accept(e){return e.visitKey?e.visitKey(this):e.visitChildren(this)}}var ci,di=i(15822);!function(e){e.FACT="FACT",e.VALUE="VALUE",e.LOGICAL_OPERATOR="LOGICAL_OPERATOR",e.BOOLEAN_OPERATOR="BOOLEAN_OPERATOR",e.NUMERIC_COMPARE_OPERATOR="NUMERIC_COMPARE_OPERATOR",e.OPEN_ROUND_BRACKET="OPEN_ROUND_BRACKET",e.CLOSE_ROUND_BRACKET="CLOSE_ROUND_BRACKET",e.UNKNOWN="UNKNOWN",e.ERROR="ERROR"}(ci||(ci={}));const ui=e=>({type:ci.FACT,value:e}),pi=e=>({type:ci.VALUE,value:e}),mi=e=>({type:ci.CLOSE_ROUND_BRACKET,value:e}),gi=e=>({type:ci.UNKNOWN,value:e});class yi extends di.AbstractParseTreeVisitor{defaultResult(){return[]}aggregateResult(e,t){const i=0===(n=e.filter((e=>e.type!==ci.ERROR))).length?void 0:n[n.length-1];var n;const a=(e=>0===e.length?void 0:e[0])(t.filter((e=>e.type!==ci.ERROR)));return i&&a&&i.type===ci.LOGICAL_OPERATOR&&a.type===ci.LOGICAL_OPERATOR&&(a.type=ci.ERROR),[...e,...t]}visitTerminal(e){return e.symbol.type===Lt.Token.EOF?[]:"("===e.text?[("(",{type:ci.OPEN_ROUND_BRACKET,value:"("})]:")"===e.text?[mi(")")]:[gi(e.text)]}visitErrorNode(e){return"<missing ')'>"===e.text?[mi(")")]:[(t=e.text,{type:ci.ERROR,value:t})];var t}visitLogical_operator(e){return[(t=e.text,{type:ci.LOGICAL_OPERATOR,value:t})];var t}visitBoolean_operator(e){return[(t=e.text,{type:ci.BOOLEAN_OPERATOR,value:t})];var t}visitNumeric_compare_operator(e){return[(t=e.text,{type:ci.NUMERIC_COMPARE_OPERATOR,value:t})];var t}visitKey(e){var t;const i=e.SIMPLETEXT();if(i)return[ui(i.text)];const n=null===(t=e.STRING())||void 0===t?void 0:t.text;return n&&n.length>=2?[ui(n.substr(1,n.length-2))]:[ui("")]}visitValue(e){const t=e.NUMBER()||e.STRING();if(!t){if(e.parent instanceof Xt||e.parent,e.text)return e.childCount>1&&e.start.inputStream&&e.stop?[pi(`"${e.start.inputStream.toString().slice(e.start.startIndex,e.stop.stopIndex+1)}"`)]:[pi(`"${e.text}"`)];if(e.start.inputStream&&e.stop&&e.stop.text){let t=e.start.inputStream.toString().slice(e.stop.stopIndex+1,e.start.startIndex).trimLeft();return t.startsWith('"')&&!t.endsWith('"')?t+='"':t.startsWith("'")&&!t.endsWith("'")&&(t+="'"),[pi(t)]}return this.visitChildren(e)}return[pi(t.text)]}visitNumerical_value(e){return[pi(e.text)]}}const hi=e=>e.map((e=>e.value)).join(" "),Ei=(0,u.style)({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),vi=(e,t)=>{try{const o=((e,t)=>{const i=(e=>{const t=Lt.CharStreams.fromString(e),i=new Ut(t);i.removeErrorListeners();const n=new Lt.CommonTokenStream(i),a=new Wt(n);return a.removeErrorListeners(),a})(e).expression(),n=(new yi).visit(i).filter((e=>e.type!==ci.ERROR));let a=n.pop();const r=[];if(void 0===a)return{prefix:"",options:t.slice(0,10).map((e=>e.name||"")),postfix:""};for(;a.type===ci.CLOSE_ROUND_BRACKET;){const e=n.pop();if(void 0===e)break;r.unshift(a),a=e}const o=hi(n),l=hi(r),s=a;return s.type===ci.FACT?{prefix:o,options:t.filter((e=>e.name&&e.name.toUpperCase().includes(s.value.toUpperCase()))).slice(0,10).map((e=>e.name||"")),postfix:l}:(r.unshift(s),{prefix:o,options:[],postfix:hi(r)})})(e,t);if(o)return i=o.prefix,n=o.options,a=o.postfix,(i=i.trim()).length>0&&n.length>0&&(i+=" "),a.length>0&&n.length>0&&(a=" "+a),(n||[" "]).map((e=>r.createElement(s.SelectOption,{className:Ei,key:i+e+a,value:i+e+a},i,r.createElement("b",null,e),a)))}catch(t){console.log(`Exception when computing options for condition [${e}]`,t)}var i,n,a;return[]},bi=e=>{const{facts:t,onSelect:i,value:n}=e,[a,o]=r.useState(!1),[l,c]=r.useState(),d=r.useCallback((e=>vi(e,t)),[t]),u=r.useCallback((e=>{const t=d(n);if(e){let e=t.length>0;1===t.length&&t[0].props.value===n&&(e=!1),o(e)}c(t)}),[n,d,c]);(0,At.Z)((()=>{u(!0)}),[u]),(0,kt.Z)((()=>{u(!1)}));const m=r.useCallback((e=>{const t=e.target.value;return i(t),[]}),[i]),g=r.useCallback(((e,t)=>{i(t.toString()),c((e=>(e&&1===e.length&&e[0].props.value===t&&o(!1),e)))}),[i]),y=r.useCallback((()=>{i("")}),[i]),h=r.useCallback((e=>{o(e)}),[]);return r.createElement(s.Select,Object.assign({},p("ConditionField",e),{label:e.label,toggleId:e.id,name:e.name,onToggle:h,isOpen:a,selections:n,variant:s.SelectVariant.typeahead,onSelect:g,onFilter:m,onClear:y,typeAheadAriaLabel:"Condition writer",style:{maxWidth:"100%"}}),l)};const fi=e=>{const{hint:t}=e,i=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i}(e,["hint"]),[n,a,{setValue:o}]=(0,Xe.useField)(Object.assign({},i)),l=!a.error||!a.touched,c=r.useCallback((e=>{o(e)}),[o]);return r.createElement(s.FormGroup,{fieldId:e.id,helperTextInvalid:a.error,isRequired:e.isRequired,validated:l?"default":"error",label:e.label},r.createElement(bi,Object.assign({},i,n,{value:n.value?n.value.toString():"",onSelect:c})),t&&r.createElement(s.Text,{component:s.TextVariants.small},t))},_i=(0,u.style)({fontFamily:"monospace",fontSize:"14px",fontStyle:"default"}),Ti=(0,u.style)({marginBottom:5}),Ci=(0,u.style)({marginLeft:20});class Pi extends r.Component{render(){return r.createElement(s.TextContent,{className:Ci},r.createElement(s.Text,{component:s.TextVariants.p},h.wizards.policy.hints.hintParagraph1),r.createElement(s.Text,{component:s.TextVariants.a,className:Ti,href:Te.pages.factsDocumentation,target:"_blank",rel:"noopener noreferrer"},h.wizards.policy.hints.hintLinkTitle),r.createElement(s.Text,{component:s.TextVariants.h5,className:"lg"},h.wizards.policy.hints.hintSyntaxExamplesSection),r.createElement(s.Text,null,h.wizards.policy.hints.hintQuestion1),r.createElement(s.Text,{component:s.TextVariants.p,className:_i},r.createElement("i",null,h.wizards.policy.hints.hintQuestion1Ans)),r.createElement(s.Text,null,h.wizards.policy.hints.hintQuestion2),r.createElement(s.Text,{component:s.TextVariants.p,className:_i},r.createElement("i",null,h.wizards.policy.hints.hintQuestion2Ans)),r.createElement(s.Text,null,h.wizards.policy.hints.hintQuestion3),r.createElement(s.Text,{component:s.TextVariants.p,className:_i},r.createElement("i",null,h.wizards.policy.hints.hintQuestion3Ans)),r.createElement(s.Text,null,h.wizards.policy.hints.hintQuestion4),r.createElement(s.Text,{component:s.TextVariants.p,className:_i},r.createElement("i",null,h.wizards.policy.hints.hintQuestion4Ans)))}}const Si=e=>r.createElement(r.Fragment,null,r.createElement(s.StackItem,Object.assign({},p("Policy/Wizard/Usage",e)),r.createElement(s.ExpandableSection,{toggleText:h.wizards.policy.hints.hintTitle},r.createElement(Pi,null)))),xi=(0,u.style)({marginTop:"auto",marginBottom:"auto",marginLeft:8}),Oi=(0,u.style)({width:"100%"}),Ni=(0,u.style)({marginTop:12}),Ii=(0,u.style)({color:ut.ZP.var}),Ri=(0,u.style)({color:wt.ZP.var}),wi=(0,u.style)({fontWeight:"bold"}),Ai=(0,u.style)({marginBottom:5}),ki=e=>e.loading?r.createElement(s.Split,null,r.createElement(s.SplitItem,null,r.createElement("span",{className:xi},r.createElement(s.Spinner,{size:"md"})),r.createElement("span",{className:xi}," ",h.wizards.policy.conditions.validating," "))):e.changed?null:e.isValid?r.createElement(s.Split,null,r.createElement(s.SplitItem,null,r.createElement(I.ZP,{className:xi,color:wt.ZP.value})),r.createElement(s.SplitItem,null,r.createElement("div",{className:(0,a.joinClasses)(xi,Ri,wi)},h.wizards.policy.conditions.valid))):e.error?r.createElement(s.Stack,null,r.createElement(s.StackItem,null,r.createElement(s.Split,null,r.createElement(s.SplitItem,null,r.createElement(dt.ZP,{className:xi,color:ut.ZP.value})),r.createElement(s.SplitItem,null,r.createElement("div",{className:(0,a.joinClasses)(xi,Ii,wi)},h.wizards.policy.conditions.invalid)))),r.createElement(s.StackItem,null,r.createElement("div",{className:(0,a.joinClasses)(xi,Ii)}," ",e.error," "))):null,Li=()=>{var e;const t=r.useContext(pt),{values:i}=(0,Xe.useFormikContext)(),n=!i.conditions||""===i.conditions||t.isLoading;return r.createElement(a.Form,{ouiaId:"condition-step"},r.createElement(s.Title,{className:Ai,headingLevel:"h4",size:"xl"},h.wizards.policy.conditions.title),h.wizards.policy.conditions.summaryDesc,r.createElement(fi,{ouiaId:"conditions",label:"Condition text",id:"conditions",name:"conditions",facts:t.facts||[],hint:h.wizards.policy.conditions.hint}),r.createElement(s.Stack,{className:Oi},r.createElement(s.StackItem,null,r.createElement(s.Button,{onClick:()=>{t.triggerAction(ct.VALIDATE_CONDITION)},isDisabled:n,variant:s.ButtonVariant.secondary},"Validate condition")),r.createElement(s.StackItem,{className:Ni},r.createElement(ki,Object.assign({loading:t.isLoading},t.verifyResponse,{changed:(null===(e=t.verifyResponse.policy)||void 0===e?void 0:e.conditions)!==i.conditions})))),r.createElement(Si,null))},Di=r.createContext(void 0),Fi=e=>{var t;const[i,n]=r.useState(!1),[o,l]=r.useState({}),s=xe(void 0,!1),c=(0,a.useSort)(),d=Oe(s.debouncedFilters,5,c.sortBy),u=Ze(d.page,!1);let p,m=0;"PagedResponseOfPolicy"===(null===(t=u.payload)||void 0===t?void 0:t.type)&&(p=u.payload.value.data,m=u.payload.value.count);const g=Me(p,u.loading,m,d.page),{query:y}=u;return(0,At.Z)((()=>{e.showCreateStep&&y()}),[y,d.page,s.debouncedFilters,e.showCreateStep]),e.showCreateStep?r.createElement(Di.Provider,{value:{copyPolicy:i,setCopyPolicy:n,copiedPolicy:o,setCopiedPolicy:l,policyFilter:s,policyPage:d,policySort:c,policyQuery:u,policyRows:g}},e.children):r.createElement(r.Fragment,null,e.children)},Mi=e=>{var t;const{policyFilter:i,policyPage:n,policySort:a,policyQuery:o,policyRows:l}=e;(0,kt.Z)((()=>{o.payload||o.query()}));const s=e.onSelect,c=o.payload,d=l.onSelect,u=r.useCallback(((e,t,i)=>{d(e,t,i),c&&"PagedResponseOfPolicy"===c.type&&i&&s(c.value.data[t])}),[s,d,c]),{pageCount:p,count:m}="PagedResponseOfPolicy"===(null===(t=o.payload)||void 0===t?void 0:t.type)?{count:o.payload.value.count,pageCount:o.payload.value.data.length}:{count:void 0,pageCount:void 0};return r.createElement(r.Fragment,null,r.createElement(fe,{ouiaId:"copy-from-policy-toolbar",onPaginationChanged:n.changePage,page:n.page.index,pageCount:p,perPage:n.page.size,showPerPageOptions:!1,hideActions:!0,hideBulkSelect:!0,filters:i.filters,setFilters:i.setFilters,clearFilters:i.clearFilter,count:m},r.createElement(ye,{ouiaId:"copy-from-policy-table",columnsToShow:["radioSelect","name","actions"],policies:l.rows,onSelect:u,loading:o.loading,loadingRowCount:5,onSort:a.onSort,sortBy:a.sortBy,linkToDetailPolicy:!1})))};const Vi="pf-u-mb-sm",Bi="pf-c-radio",Ui=()=>{const{copyPolicy:e,createFromScratch:t,copyExisting:i,copyFromPolicyHandler:n,copyFromPolicyProps:o}=(()=>{const e=r.useContext(Di);if(void 0===e)throw Error("Invalid usage of CreatePolicyStep without valid context");const{copyPolicy:t,setCopyPolicy:i,copiedPolicy:n,setCopiedPolicy:a}=e,o=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i}(e,["copyPolicy","setCopyPolicy","copiedPolicy","setCopiedPolicy"]),{clearSelection:l}=o.policyRows,{validate:s,validateField:c,setValues:d,setFieldValue:u}=(0,Xe.useFormikContext)(),{setVerifyResponse:p,setMaxStep:m}=(0,r.useContext)(pt),g=r.useCallback((()=>{i(!1),a({})}),[i,a]),y=r.useCallback((()=>{i(!0),a(void 0)}),[i,a]);(0,At.Z)((()=>{n&&(d(n),t&&p({policy:n,isValid:!0})),m(0),u("isValid",!!n),s&&c("isValid")}),[t,n,s,c,u,d,p]),r.useEffect((()=>{t||l()}),[t,l]);const h=r.useCallback((e=>{a(Qe(e))}),[a]);return{copyPolicy:t,createFromScratch:g,copyExisting:y,copyFromPolicyHandler:h,copyFromPolicyProps:o}})();return r.createElement(r.Fragment,null,r.createElement(a.Form,{ouiaId:"create-policy-step",className:"pf-c-form"},r.createElement("div",{className:"pf-c-form__group"},r.createElement(s.Title,{headingLevel:"h4",size:"xl",className:Vi},h.wizards.policy.createPolicy.title),r.createElement(s.Text,{className:(0,a.joinClasses)(Vi,"pf-c-title pf-m-sm"),component:s.TextVariants.h6},"Define a new policy:"),r.createElement(s.Radio,{isChecked:!e,name:"new-policy",value:"from-scratch",id:"create-new-custom-policy-from-scratch",onChange:t,label:"From scratch",className:(0,a.joinClasses)(Vi,Bi)}),r.createElement(s.Radio,{isChecked:e,name:"new-policy",value:"as-copy",id:"create-new-custom-policy-as-copy",onChange:i,label:"As a copy of existing Policy",className:(0,a.joinClasses)(Vi,Bi)}),e&&r.createElement(r.Fragment,null,r.createElement(Mi,Object.assign({onSelect:n},o))))))},ji=()=>r.createElement(a.Form,{ouiaId:"detail-step"},r.createElement(s.Title,{headingLevel:"h4",size:"xl"},h.wizards.policy.details.title),r.createElement(a.FormTextInput,{ouiaId:"name",maxLength:150,isRequired:!0,label:"Name",type:"text",name:"name",id:"name"}),r.createElement(a.FormTextArea,{ouiaId:"description",label:"Description",type:"text",id:"description",name:"description",resizeOrientation:"vertical"})),Gi=(0,u.style)(Object.assign(Object.assign({backgroundColor:G.ZP.var},(0,z.padding)(18,14)),{margin:5})),zi=()=>{const e=(0,r.useContext)(pt),{values:t}=(0,Xe.useFormikContext)();return r.createElement(r.Fragment,null,r.createElement(a.Form,{ouiaId:"review-step"},r.createElement(s.Title,{headingLevel:"h2",size:"xl"},h.wizards.policy.review.title),r.createElement(a.Switch,{ouiaId:"is-enabled",isDisabled:e.isLoading,id:"isEnabled",name:"isEnabled",labelOn:h.wizards.policy.review.policyIsEnabled,labelOff:h.wizards.policy.review.policyIsDisabled,label:h.wizards.policy.review.enableThisPolicy}),r.createElement(s.Title,{headingLevel:"h2",size:"md"},h.wizards.policy.review.policy.details),r.createElement(a.FormText,{ouiaId:"name",label:h.wizards.policy.review.policy.name,name:"name",id:"name"}),r.createElement(a.FormText,{ouiaId:"description",label:h.wizards.policy.review.policy.description,name:"description",id:"description"}),r.createElement("div",{className:Gi},r.createElement(Y,{ouiaId:"review-step.conditions",conditions:t.conditions})),r.createElement("div",{className:Gi},r.createElement(W,{ouiaId:"review-step.actions",actions:t.actions||[]}))))},Hi=(e,t,i,n,a)=>!a&&(e===i||(t?e<=n:e<=i)),Qi=(e,t)=>!t&&e,qi=e=>{const t=(0,Xe.useFormikContext)(),i=t.validateForm,n=t.handleSubmit;r.useEffect((()=>{i()}),[e.currentStep,i]),r.useEffect((()=>{e.triggeredAction!==ct.NONE&&n()}),[e.triggeredAction,n]);const a={isLoading:e.isLoading,isFormValid:t.isValid,triggerAction:e.triggerAction,verifyResponse:e.verifyResponse,createResponse:e.createResponse,setVerifyResponse:e.setVerifyResponse,facts:e.facts,setMaxStep:e.setMaxStep},o=e.steps[e.currentStep],l=((e,t,i)=>e.isValid?e.isValid(t,i):t.isFormValid)(o,a,t.values);a.isValid=l;const c=e.steps.map((t=>Object.assign(Object.assign({},t),{enableNext:Qi(l,e.isLoading),canJumpTo:Hi(t.id,l,e.currentStep,e.maxStep,e.isLoading)})));return r.createElement(s.Form,null,r.createElement(pt.Provider,{value:a},r.createElement(s.Wizard,{isOpen:!0,onSave:()=>{e.triggerAction(ct.SAVE)},onClose:e.onClose,steps:c,startAtStep:e.currentStep+1,onNext:e.onMove,onBack:e.onMove,onGoToStep:e.onMove,title:e.isEditing?h.wizards.policy.titleEdit:h.wizards.policy.titleNew,description:h.wizards.policy.description,footer:r.createElement(yt,{onNext:o.onNext,loadingText:"Loading",isLoading:e.isLoading,error:e.createResponse.error})})))},Zi=e=>{const[t,i]=r.useState(0),[n,a]=r.useState(0),[o,l]=r.useState({type:ct.NONE}),[s,c]=r.useState({isValid:!1}),d=(0,Je.Z)(),[u,p]=r.useState({created:!1}),m=r.useCallback((e=>{let t,i;const n=new Promise(((e,n)=>{t=e,i=n}));return l((n=>(n.rejecter&&n.rejecter(),{type:e,resolver:t,rejecter:i}))),n}),[l]),g=r.useCallback((e=>{l((t=>(e&&t.resolver?t.resolver():t.rejecter&&t.rejecter(),{type:ct.NONE})))}),[l]);r.useEffect((()=>{var t;(null===(t=e.initialValue)||void 0===t?void 0:t.conditions)&&c({isValid:!0,policy:e.initialValue})}),[e.initialValue]);const y=(e=>{const t=[];return e&&t.push(Object.assign({name:h.wizards.policy.createPolicy.title,component:r.createElement(Ui,null),validationSchema:et.Ry().shape({isValid:et.O7().oneOf([!0])})},void 0)),t.push(Object.assign({name:h.wizards.policy.details.title,component:r.createElement(ji,null),validationSchema:rt,onNext:(e,t)=>{e.triggerAction(ct.VALIDATE_NAME).then(t).catch((e=>{console.error("Error when validating:",e)}))}},void 0),Object.assign({name:h.wizards.policy.conditions.title,component:r.createElement(Li,null),validationSchema:lt,isValid:(e,t)=>{var i;return t.conditions===(null===(i=e.verifyResponse.policy)||void 0===i?void 0:i.conditions)&&e.verifyResponse.isValid}},void 0),Object.assign({name:h.wizards.policy.actions.title,component:r.createElement(Rt,null),validationSchema:ot},void 0),Object.assign({name:h.wizards.policy.review.title,component:r.createElement(zi,null),validationSchema:st},{nextButtonText:"Finish"})),t.map(((e,t)=>Object.assign(Object.assign({},e),{id:t})))})(e.showCreateStep);return r.createElement(r.Fragment,null,r.createElement(Fi,{showCreateStep:e.showCreateStep},r.createElement(Xe.Formik,{initialValues:e.initialValue,initialStatus:{},validateOnMount:!1,validationSchema:y[t].validationSchema,onSubmit:(t,i)=>{i.setSubmitting(!1),l((e=>Object.assign(Object.assign({},e),{type:ct.NONE})));const n=st.cast(t);switch(i.setValues(n),o.type){case ct.SAVE:e.onSave(n).then((e=>{d()&&(p(e),g(e.created))}));break;case ct.VALIDATE_CONDITION:case ct.NONE:case ct.VALIDATE_NAME:break;default:(0,P.vE)(o.type)}},validate:t=>{const i=st.cast(t);switch(o.type){case ct.SAVE:case ct.NONE:break;case ct.VALIDATE_CONDITION:e.onVerify(i).then((e=>{c(e),g(e.isValid)}));break;case ct.VALIDATE_NAME:e.onValidateName(i).then((e=>{p(e),g(!e.error)}));break;default:(0,P.vE)(o.type)}}},r.createElement(qi,{currentStep:t,maxStep:n,isLoading:e.isLoading,triggeredAction:o.type,triggerAction:m,steps:y,verifyResponse:s,createResponse:u,setVerifyResponse:c,onClose:e.onClose,onMove:(e,t)=>{const r=e.id;i(r),r>n&&a(r)},showCreateStep:e.showCreateStep,facts:e.facts,setMaxStep:a,isEditing:e.isEditing}))))},$i=Ie.GetFacts.actionCreator,Wi=e=>e.id?Ie.PutPoliciesByPolicyId.actionCreator({policyId:e.id,body:ze(e)}):Ie.PostPolicies.actionCreator({alsoStore:!0,body:ze(e)}),Ki=(0,we.validationResponseTransformer)((e=>"Policy"===e.type?(0,we.validatedResponse)("Policy",e.status,He(e.value),e.errors):e)),Yi=e=>{var t;return Ie.PostPoliciesValidateName.actionCreator({body:null!==(t=e.name)&&void 0!==t?t:"",id:e.id})},Xi=e=>Ie.PostPoliciesValidate.actionCreator({body:ze(e)}),Ji=e=>{const t=(0,a.useTransformQueryResponse)((0,Re.useMutation)(Wi),Ki),i=(0,Re.useMutation)(Xi),n=(0,Re.useParameterizedQuery)(Yi),o=(()=>{const[e,t]=(0,r.useState)(),{payload:i}=(0,Re.useQuery)($i(),!0);return(0,r.useEffect)((()=>{200===(null==i?void 0:i.status)&&t(i.value)}),[i,t]),e})(),l=r.useCallback((e=>(0,n.query)(e).then((e=>e.status===Ye.OK?{created:!1}:{created:!1,error:`Invalid name (Code: ${e.status})`}))),[n.query]),s=t.loading||i.loading||n.loading;return r.createElement(r.Fragment,null,e.isOpen&&r.createElement(Zi,{initialValue:e.initialValue||{},onClose:()=>{e.close(void 0)},onSave:i=>t.mutate(i).then((t=>{var n,r,o;if("Policy"===(null===(n=t.payload)||void 0===n?void 0:n.type))return void 0===i.id?(0,a.addSuccessNotification)("Created",`Policy "${i.name}" created`):(0,a.addSuccessNotification)("Saved",`Policy "${i.name}" has been updated`),e.close&&e.close(t.payload.value),{created:!0};if(t.status===Ye.Hi&&void 0!==i.id)return{created:!1,error:"This policy cannot be found. It may have been deleted by another user. Your changes cannot be saved."};let l=`Unknown Error when trying to ${void 0===i.id?"create":"update"} the policy: (Code ${t.status})`;return"Msg"===(null===(r=t.payload)||void 0===r?void 0:r.type)&&(l=null!==(o=t.payload.value.msg)&&void 0!==o?o:l),{created:!1,error:l}})),onVerify:e=>i.mutate(e).then((t=>{var i;return t.status===Ye.OK?{isValid:!0,policy:e}:"Msg"===(null===(i=t.payload)||void 0===i?void 0:i.type)&&t.payload.value.msg?{isValid:!1,error:t.payload.value.msg,policy:e}:{isValid:!1,error:`Unknown Error when trying to validate: (Code ${t.status})`,policy:e}})),onValidateName:l,showCreateStep:!!e.policiesExist&&e.showCreateStep,isLoading:s,facts:o,isEditing:e.isEditing}))};const en=e=>{const t=r.useCallback((()=>{return t=void 0,i=void 0,r=function*(){const t=e.policy,i=e.onDelete,n=e.getPolicies;if(t)return i([t.id]);if(!n)throw new Error("Expected policy or getPolicies to bet set");try{return i(yield n())}catch(e){(0,a.addDangerNotification)("Error while removing","An error occurreds while trying to remove the selection, please try again."),console.error("Error while fetching selection",e)}return!1},new((n=void 0)||(n=Promise))((function(e,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function l(e){try{s(r.throw(e))}catch(e){a(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,l)}s((r=r.apply(t,i||[])).next())}));var t,i,n,r}),[e.onDelete,e.policy,e.getPolicies]),i=r.useMemo((()=>e.policy?r.createElement(r.Fragment,null,"Do you want to remove the policy ",r.createElement("b",null,e.policy.name),"?"):1===e.count?r.createElement(r.Fragment,null,"Do you want to remove the selected policy?"):r.createElement(r.Fragment,null,"Do you want to remove the ",r.createElement("b",null,e.count)," selected policies?")),[e.policy,e.count]);return e.policy||e.getPolicies?r.createElement(a.DeleteModal,{isOpen:!0,isDeleting:e.isDeleting,title:"Remove "+(1===e.count?"policy":"policies"),content:i,onClose:e.onClose,onDelete:t,error:e.error}):null},tn=e=>Ie.DeletePoliciesIds.actionCreator({body:e}),nn=e=>{const{onDeleted:t}=e,{mutate:i,loading:n}=(0,Re.useMutation)(tn),o=n||e.loading,l=r.useCallback((e=>i(e).then((i=>{var n;let r=e.length;if(200===(null===(n=i.payload)||void 0===n?void 0:n.status)){const n=i.payload.value;r=e.filter((e=>!n.includes(e))).length,i.payload.value.forEach((e=>t&&t(e)))}return r>0&&(1===r?(0,a.addDangerNotification)("Error removing policy","There was an error when trying to remove a policy."):(0,a.addDangerNotification)("Error removing policies",`There was an error when trying to remove ${r} policies.`)),r!==e.length}))),[i,t]);return r.createElement(en,{policy:e.policy,count:e.count,getPolicies:e.getPolicies,isDeleting:o,onClose:e.onClose,onDelete:l})};var an=i(96733);const rn=()=>r.createElement("br",null),on=e=>r.createElement(g,{icon:an.ZP,title:h.pages.listPage.emptyState.title,content:(0,a.join)(h.pages.listPage.emptyState.text,rn),action:e.createPolicy,actionLabel:"Create policy"});var ln=i(89836),sn=i.n(ln);class cn extends a.ExporterCsv{serialize(e){return Object.assign(Object.assign({},e),{actions:je(e.actions)})}headers(){return[["id","id"],["name","name"],["description","description"],["isEnabled","isEnabled"],["conditions","conditions"],["actions","actions"],["lastTriggered","lastTriggered"],["mtime","mtime"],["ctime","ctime"]]}}class dn extends a.ExporterJson{}var un=i(20777),pn=i(24094);const mn=(0,u.style)({paddingBottom:0}),gn=e=>Ie.GetPoliciesById.actionCreator({id:e}),yn=(0,we.validationResponseTransformer)((e=>"Policy"===e.type?(0,we.validatedResponse)("Policy",e.status,He(e.value),e.errors):e)),hn=e=>{const[t,i]=r.useState(!1),n=r.useCallback((()=>{i(!1)}),[]),a=r.useMemo((()=>{const t=e.changeEnabled,i=[];return e.isEnabled?i.push(r.createElement(s.DropdownItem,{isDisabled:e.loadingEnabledChange,onClick:()=>t(!1),key:"disable"},"Disable")):i.push(r.createElement(s.DropdownItem,{isDisabled:e.loadingEnabledChange,onClick:()=>t(!0),key:"enable"},"Enable")),i.push(r.createElement(s.DropdownItem,{key:"edit",onClick:e.edit},"Edit"),r.createElement(s.DropdownItem,{key:"duplicate",onClick:e.duplicate},"Duplicate"),r.createElement(s.DropdownItem,{key:"delete",onClick:e.delete},"Remove")),i}),[e.isEnabled,e.changeEnabled,e.edit,e.duplicate,e.delete,e.loadingEnabledChange]);return r.createElement(s.Dropdown,{position:s.DropdownPosition.right,onSelect:n,toggle:r.createElement(s.KebabToggle,{"data-testid":"policy-detail-actions-button",isDisabled:e.disabled,onToggle:i,id:"policy-detail-actions-menu"}),isOpen:t,isPlain:!0,dropdownItems:a})};var En=i(16730),vn=i(50744);const bn=e=>{const t=(0,v.k6)(),i=r.useCallback((()=>{t.push(Yn.listPage())}),[t]);return r.createElement(g,{icon:En.ZP,title:h.pages.policyDetail.emptyState.title,content:(0,vn.WU)(h.pages.policyDetail.emptyState.text,e.policyId),actionLabel:h.pages.policyDetail.emptyState.backText,action:i})},fn=(e,t,i="br")=>r.useMemo((()=>{const n=(0,vn.WU)(e,...t);return i?(0,a.join)(n.split("\n"),i):n}),[i,...t]),_n=e=>{const t=fn(h.pages.policyDetail.errorState.text,[e.error]);return r.createElement(g,{icon:dt.ZP,iconColor:ut.ZP.value,title:h.pages.policyDetail.errorState.title,content:t,action:e.action,actionLabel:h.pages.policyDetail.errorState.actionText})};var Tn,Cn=i(88696);!function(e){e[e.EDIT=0]="EDIT",e[e.DUPLICATE=1]="DUPLICATE",e[e.CLOSE=2]="CLOSE"}(Tn||(Tn={}));const Pn={isEditing:!1,initialValue:void 0,isOpen:!1},Sn=(0,u.style)({marginLeft:Et.ZP.var}),xn=e=>{if(e.loading)return r.createElement(s.Stack,{"data-testid":"loading"},r.createElement(s.StackItem,null,r.createElement(s.Skeleton,{width:"140px"})));const{icon:t,text:i}=e.isEnabled?{icon:r.createElement(R,null),text:"Enabled"}:{icon:r.createElement(N,null),text:"Disabled"};return r.createElement(s.Stack,null,r.createElement(s.StackItem,null,t,r.createElement("span",{className:Sn},i)))};var On=i(60472);const Nn=(0,u.style)({width:200}),In=()=>r.createElement(r.Fragment,null,r.createElement(l.PageHeader,{"data-testid":"policy-loading"},r.createElement(s.Stack,null,r.createElement(s.StackItem,null,r.createElement(s.Breadcrumb,null,r.createElement(a.BreadcrumbLinkItem,{ouiaId:"to-list-page",to:Yn.listPage()},"Policies"),r.createElement(s.BreadcrumbItem,null,r.createElement(s.Skeleton,{className:Nn})))),r.createElement(s.StackItem,null,r.createElement(s.Split,null,r.createElement(s.SplitItem,{isFilled:!0},r.createElement(l.PageHeaderTitle,{title:r.createElement(s.Skeleton,{width:"25%"})})),r.createElement(s.SplitItem,null,r.createElement(s.Button,{isDisabled:!0,variant:s.ButtonVariant.plain},r.createElement(On.ZP,null))))))),r.createElement(l.Main,null,r.createElement(a.Section,{ouiaId:"loading-spinner"},r.createElement(s.Bullseye,null,r.createElement(l.Spinner,{centered:!0}))))),Rn=()=>r.createElement(g,{title:h.tables.trigger.emptyState.notFound.title,content:h.tables.trigger.emptyState.notFound.content}),wn=[{title:h.tables.trigger.columns.date,transforms:[C.sortable],cellTransforms:[C.nowrap]},{title:h.tables.trigger.columns.system,transforms:[C.sortable],cellTransforms:[C.wrappable,C.breakWord]}],An=e=>{const t=r.useMemo((()=>{const t=e.rows;return t?t.map(((e,t)=>{return{id:`${e.id}-${t}`,key:`${e.id}-${t}`,cells:[{title:r.createElement(C.TableText,null,(0,X.Z)((0,a.toUtc)(e.created),"dd MMM yyyy HH:mm:ss")," UTC")},{title:e.id?r.createElement(C.TableText,null,r.createElement("a",{href:(i=e.id,(0,a.localUrl)(`/insights/inventory/${i}/`,(0,a.getInsights)().chrome.isBeta()))},e.hostName)):r.createElement(C.TableText,null,e.hostName)}]};var i})):[]}),[e.rows]),i=r.useCallback(((t,i,n)=>{const r=e.onSort;r&&r(i,0===i?"ctime":"name",n===C.SortByDirection.asc?a.Direction.ASCENDING:a.Direction.DESCENDING)}),[e.onSort]),n=r.useMemo((()=>{if(e.sortBy)return{index:"ctime"===e.sortBy.column?0:1,direction:e.sortBy.direction===a.Direction.ASCENDING?"asc":"desc"}}),[e.sortBy]);return e.loading?r.createElement(l.SkeletonTable,{testID:"trigger-table-loading",rowSize:10,columns:wn,sortBy:n}):0===t.length?r.createElement(Rn,null):r.createElement("div",Object.assign({},p("Trigger/Table",e)),r.createElement(C.Table,{"aria-label":h.tables.trigger.title,rows:t,cells:wn,onSort:i,sortBy:n},r.createElement(C.TableHeader,null),r.createElement(C.TableBody,null)))};var kn;!function(e){e.NAME="name"}(kn||(kn={}));const Ln={[kn.NAME]:{label:"System",placeholder:"Filter by System"}},Dn=e=>{const t=(0,a.usePrimaryToolbarFilterConfig)(kn,e.filters,e.setFilters,e.clearFilters,Ln),i=r.useMemo((()=>({itemCount:e.count||0,page:e.page.index,perPage:e.page.size,perPageOptions:void 0,onSetPage:e.onPaginationChanged,onFirstClick:e.onPaginationChanged,onPreviousClick:e.onPaginationChanged,onNextClick:e.onPaginationChanged,onLastClick:e.onPaginationChanged,onPageInput:e.onPaginationChanged,onPerPageSelect:e.onPaginationSizeChanged,isCompact:!0,variant:s.PaginationVariant.top})),[e.onPaginationChanged,e.page,e.count,e.onPaginationSizeChanged]),n=r.useMemo((()=>({itemCount:e.count||0,page:e.page.index,perPage:e.page.size,perPageOptions:void 0,onSetPage:e.onPaginationChanged,onFirstClick:e.onPaginationChanged,onPreviousClick:e.onPaginationChanged,onNextClick:e.onPaginationChanged,onLastClick:e.onPaginationChanged,onPageInput:e.onPaginationChanged,onPerPageSelect:e.onPaginationSizeChanged,isCompact:!1,variant:s.PaginationVariant.bottom})),[e.onPaginationChanged,e.page,e.count,e.onPaginationSizeChanged]),o=r.useMemo((()=>{const t=e.onExport;return{extraItems:[],onSelect:(e,i)=>{t((0,a.exporterTypeFromString)(i))},"data-testid":"trigger-toolbar-export-container"}}),[e.onExport]);return r.createElement("div",Object.assign({},p("Trigger/TableDualToolbar",e)),r.createElement(l.PrimaryToolbar,{pagination:i,exportConfig:o,filterConfig:t.filterConfig,activeFiltersConfig:t.activeFiltersConfig}),e.children,r.createElement(l.PrimaryToolbar,{pagination:n}))};class Fn extends a.ExporterCsv{serialize(e){return Object.assign({},e)}headers(){return[["created","ctime"],["hostName","system"],["id","id"]]}}class Mn extends a.ExporterJson{}const Vn=e=>({id:e.id||"",hostName:e.hostName||"",created:e.ctime?(0,Be.Z)(e.ctime/1e3):new Date(Date.now())}),Bn=e=>Ie.GetPoliciesByIdHistoryTrigger.actionCreator(Object.assign({id:e.policyId},e.page.toQuery())),Un=(0,we.validationResponseTransformer)((e=>{var t,i,n;if("PagedResponseOfHistoryItem"===e.type){const a=e.value;return Object.assign(Object.assign({},e),{type:"PagedTriggers",value:{count:(null===(t=a.meta)||void 0===t?void 0:t.count)||0,data:(n=null!==(i=a.data)&&void 0!==i?i:[],n?n.map(Vn):[])}})}return e})),jn=(0,we.validationResponseTransformer)((e=>"PagedResponseOfHistoryItem"===e.type?Object.assign(Object.assign({},e),{type:"boolean",value:e.value.data&&e.value.data.length}):e)),Gn=e=>Ie.GetPoliciesByIdHistoryTrigger.actionCreator(Object.assign({id:e},a.Page.of(1,1).toQuery()));const zn=e=>(0,a.useUrlStateString)("system",e),Hn=e=>{switch(e){case kn.NAME:return zn;default:(0,P.vE)(e)}},Qn=()=>r.createElement(g,{title:h.pages.policyDetail.triggerEmptyState.title,content:h.pages.policyDetail.triggerEmptyState.text}),qn=e=>{const t=fn(h.pages.policyDetail.triggerErrorState.text,[e.error]);return r.createElement(g,{icon:dt.ZP,iconColor:ut.ZP.value,title:h.pages.policyDetail.triggerErrorState.title,content:t,action:e.action,actionLabel:h.pages.policyDetail.triggerErrorState.actionText})},Zn=a.Sort.by("ctime",a.Direction.DESCENDING),$n=e=>{var t;return e.errorContent?r.createElement(r.Fragment,null," ",e.errorContent," "):e.payload&&e.payload.count>0||e.loading?r.createElement(An,{rows:null===(t=e.payload)||void 0===t?void 0:t.data,onSort:e.sort.onSort,sortBy:e.sort.sortBy,loading:e.loading}):r.createElement(Rn,null)},Wn=(0,r.forwardRef)(((e,t)=>{var i;const{policyId:n}=e,o=((e=250)=>(0,a.useFilters)(kn,e,Hn))(),l=(()=>{const e=(0,a.useTransformQueryResponse)((0,Re.useParameterizedQuery)(Bn),Un),t=(0,a.useTransformQueryResponse)((0,Re.useParameterizedQuery)(Gn),jn),[i,n]=(0,r.useState)(),o=(0,r.useCallback)(((...i)=>{const[{policyId:a,page:r}]=i,o=e.query,l=t.query,s=!r.hasFilter()&&1===r.index;return o({policyId:a,page:r}).then((e=>{if(404===e.status){if(!s)return n(void 0),l(a).then((t=>(404===t.status?n(!1):200===t.status?n(!0):n(void 0),e)));n(!1)}else 200===e.status?n(!0):n(void 0);return e}))}),[e.query,t.query]),l=(0,r.useCallback)((()=>{const i=e.abort,n=t.abort;i(),n()}),[e.abort,t.abort]),s=(0,r.useCallback)((()=>{const i=e.reset,n=t.reset;i(),n()}),[e.reset,t.reset]);return Object.assign(Object.assign({},e),{query:o,abort:l,reset:s,status:e.status,loading:t.loading||e.loading,errorObject:t.errorObject||e.errorObject,error:t.error||e.error,hasTriggers:i})})(),s=r.useMemo((()=>{const e=l.payload;if("PagedTriggers"===(null==e?void 0:e.type))return e.value}),[l.payload]),[c,d]=r.useState(Te.defaultElementsPerPage),u=(0,a.useSort)(Zn),{page:p,onPaginationChanged:m}=((e,t,i)=>{const n=r.useMemo((()=>{const e=new a.Filter,t=(0,a.stringValue)(i[kn.NAME]);return t&&""!==t.trim()&&e.and("name",a.Operator.LIKE,t.trim()),e}),[i]),[o,l]=r.useState((()=>a.Page.of(1,e,n,t)));return(0,r.useEffect)((()=>{l((e=>e.sort!==t?a.Page.of(e.index,e.size,e.filter,t):e))}),[t]),(0,r.useEffect)((()=>{l((e=>e.filter!==n?a.Page.of(1,e.size,n,e.sort):e))}),[n]),(0,r.useEffect)((()=>{l((t=>t.size!==e?a.Page.of(1,e,t.filter,t.sort):t))}),[e]),{page:o,onPaginationChanged:r.useCallback(((e,t)=>{l((e=>e.withPage(t)))}),[l])}})(c,u.sortBy,o.debouncedFilters),g=(0,r.useCallback)((()=>{const e=l.query;n&&e({policyId:n,page:p})}),[n,l.query,p]);r.useEffect((()=>{g()}),[g]),r.useImperativeHandle(t,(()=>({refresh:g})),[g]);const y=((e,t)=>{const i=(0,Re.useClient)();return(0,r.useCallback)((()=>new Promise((n=>{return r=void 0,o=void 0,s=function*(){const r=[];let o=a.Page.of(1,200,t);for(;;){const t=yield i.query(Bn({policyId:e,page:o}));if(t.payload){const e=Un(t.payload);if("PagedTriggers"===e.type&&e.value.data){if(r.push(...e.value.data),o=o.nextPage(),o.index>a.Page.lastPageForElements(e.value.count,o.size).index)break;continue}}break}n(r)},new((l=void 0)||(l=Promise))((function(e,t){function i(e){try{a(s.next(e))}catch(e){t(e)}}function n(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof l?a:new l((function(e){e(a)}))).then(i,n)}a((s=s.apply(r,o||[])).next())}));var r,o,l,s}))),[i,e,t])})(n,p.filter),h=r.useCallback((e=>{const t=(e=>{switch(e){case a.ExporterType.CSV:return new Fn;case a.ExporterType.JSON:return new Mn}(0,P.vE)(e)})((0,a.exporterTypeFromString)(e));y().then((e=>{e.length>0&&sn()(t.export(e),`policy-${n}-triggers-${(0,X.Z)(new Date(Date.now()),"y-dd-MM")}.${t.type}`)}))}),[y,n]),E=r.useCallback(((e,t)=>{d(t)}),[d]);let v;return!l.loading&&l.error&&404!==l.status&&(v=r.createElement(qn,{action:g,error:`code: ${l.status}`})),r.createElement(a.Section,{ouiaId:"trigger-detail-section"},!1===l.hasTriggers?r.createElement(Qn,null):r.createElement(r.Fragment,null,r.createElement(Dn,{count:null==s?void 0:s.count,page:p,onPaginationChanged:m,onPaginationSizeChanged:E,pageCount:null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.length,filters:o.filters,setFilters:o.setFilters,clearFilters:o.clearFilter,onExport:h},r.createElement($n,{loading:l.loading,payload:s,sort:u,errorContent:v}))))})),Kn=(0,u.style)({paddingBottom:8,paddingTop:16}),Yn={listPage:()=>"/list",policyDetail:e=>`/policy/${e}`},Xn=[{path:Yn.listPage(),component:e=>{var t;const[i,n]=r.useState({isOpen:!1}),o=Ke(),c=xe(),d=(0,a.useSort)(),u=Oe(c.debouncedFilters,Te.defaultElementsPerPage,d.sortBy),p=(e=>{const t=Ze(e,!1),i=(0,a.useTransformQueryResponse)((0,Re.useQuery)(Ie.GetPolicies.actionCreator(a.Page.of(1,1).toQuery()),!1),$e),[n,o]=(0,r.useState)(),l=(0,r.useMemo)((()=>!e.hasFilter()&&1===e.index),[e]),s=(0,r.useCallback)((()=>{const e=t.query,n=i.query;return e().then((e=>{if(404===e.status){if(!l)return o(void 0),n().then((t=>(404===t.status?o(!1):200===t.status?o(!0):o(void 0),e)));o(!1)}else 200===e.status?o(!0):o(void 0);return e}))}),[t.query,i.query,l]),c=(0,r.useCallback)((()=>{const e=t.abort,n=i.abort;e(),n()}),[t.abort,i.abort]),d=(0,r.useCallback)((()=>{const e=t.reset,n=i.reset;e(),n()}),[t.reset,i.reset]);return Object.assign(Object.assign({},t),{query:s,abort:c,reset:d,status:t.status,loading:i.loading||t.loading,errorObject:i.errorObject||t.errorObject,error:i.error||t.error,hasPolicies:n})})(u.page),{query:m}=Ze(a.Page.of(0,a.Page.NO_SIZE,u.page.filter,u.page.sort),!1),g=Ve(),E=(0,r.useContext)(T);let v=p.loading||o.loading;const b="PagedResponseOfPolicy"===(null===(t=p.payload)||void 0===t?void 0:t.type)?p.payload.value.count:0,C=Me((e=>{if(200===(null==e?void 0:e.status))return e.value.data})(p.payload),v,b,u.page),{clearSelection:S,loadingSelected:x}=C;v=v||x;const{canReadPolicies:O,canWritePolicies:N}=E.rbac,{query:I}=p,{mutate:R,loading:w}=o,{open:A}=g,k=(0,_.Z)(w);r.useEffect((()=>{S()}),[c.debouncedFilters,S]),r.useEffect((()=>{!0!==k||w||I()}),[w,I,k]);const L=(e=>{const{rows:t,onSelect:i,removeSelection:n,clearSelection:o,selectionCount:l}=e.policyRows,{changePage:s}=e.policyPage,{index:c,size:d}=e.policyPage.page,{close:u,policy:p}=e.policyToDelete,{reload:m,count:g}=e;return{onDeleted:r.useCallback((e=>{const a=t.findIndex((t=>t.id===e));-1===a?n(e):i(t[a],a,!1)}),[t,i,n]),onCloseDeletePolicy:r.useCallback((e=>{if(e){m();const e=p?1:l,t=a.Page.lastPageForElements(g-e,d);t.index<c&&s(void 0,t.index),o()}u()}),[m,g,u,o,s,c,l,d,p])}})({policyPage:u,policyRows:C,policyToDelete:g,reload:I,count:b}),D=(e=>{const{canWrite:t,openPolicyToDelete:i,mutateChangePolicyEnabled:n,setPolicyWizardState:a}=e;return r.useCallback((e=>t?[{title:e.isEnabled?"Disable":"Enable",onClick:()=>{n({policyIds:[e.id],shouldBeEnabled:!e.isEnabled})}},{title:"Edit",onClick:()=>{a({isOpen:!0,template:e,showCreateStep:!1,isEditing:!0})}},{title:"Duplicate",onClick:()=>{a({isOpen:!0,template:Qe(e),showCreateStep:!1,isEditing:!1})}},{title:"Remove",onClick:()=>{i(e)}}]:[]),[t,i,n,a])})({canWrite:N,openPolicyToDelete:A,mutateChangePolicyEnabled:R,setPolicyWizardState:n}),F=(e=>{const{setPolicyWizardState:t,exportAllPoliciesQuery:i,mutateChangePolicyEnabled:n,openPolicyToDelete:o}=e,{selected:l,selectionCount:s,getSelected:c,rows:d}=e.policyRows;return{createCustomPolicy:r.useCallback((()=>{t({isOpen:!0,showCreateStep:!0,template:void 0,isEditing:!1})}),[t]),onDeletePolicies:r.useCallback((()=>{if(1===s){const e=d.find((e=>l.contains(e.id)));if(e)return void o(e)}o(s)}),[s,o,l,d]),onDisablePolicies:r.useCallback((()=>c().then((e=>n({shouldBeEnabled:!1,policyIds:e})))),[n,c]),onEnablePolicies:r.useCallback((()=>c().then((e=>n({shouldBeEnabled:!0,policyIds:e})))),[n,c]),onExport:r.useCallback(((e,t)=>{const n=(e=>{switch(e){case a.ExporterType.CSV:return new cn;case a.ExporterType.JSON:return new dn}(0,P.vE)(e)})((0,a.exporterTypeFromString)(t));return i().then((e=>{var t;"PagedResponseOfPolicy"===(null===(t=e.payload)||void 0===t?void 0:t.type)?sn()(n.export(e.payload.value.data),`policies-${(0,X.Z)(new Date(Date.now()),"y-dd-MM")}.${n.type}`):(0,a.addDangerNotification)("Unable to download policies","We were unable to download the policies for exporting")}))}),[i])}})({setPolicyWizardState:n,policyRows:C,openPolicyToDelete:A,mutateChangePolicyEnabled:R,exportAllPoliciesQuery:m});r.useEffect((()=>{O&&I()}),[O,I]);const M=r.useCallback((e=>{const t=E.userSettings.refresh;e&&(I(),t()),n({isOpen:!1})}),[E.userSettings.refresh,n,I]),V=r.useMemo((()=>((e,t,i)=>{if(t)switch(i){case 404:return{icon:un.ZP,title:h.tables.policy.emptyState.notFound.title,content:h.tables.policy.emptyState.notFound.content};case 401:return{icon:dt.ZP,title:"Refresh your browser",content:"Your session expired while using the application",action:e.refreshPage,actionLabel:"Reload page"};case 500:case 502:return{icon:dt.ZP,iconColor:pn.ZP.value,title:"Internal server error",content:"The server was unable to process the request, please try again.",action:e.tryAgain,actionLabel:"Try again"};default:return{icon:dt.ZP,iconColor:pn.ZP.value,title:"Unable to connect",content:"There was an error retrieving data. Check your connection and try again.",action:e.tryAgain,actionLabel:"Try again"}}})({refreshPage:()=>{window.location.reload()},tryAgain:()=>{I()}},p.error,p.status)),[p.error,p.status,I]);return r.createElement(r.Fragment,null,r.createElement(f.q,null,r.createElement("title",null,"Policies | Red Hat Insights")),r.createElement(l.PageHeader,null,r.createElement(l.PageHeaderTitle,{title:h.pages.listPage.title})),!E.userSettings.isSubscribedForNotifications&&C.rows.find((e=>e.actions.find((e=>e.type===y.EMAIL))))&&r.createElement(s.PageSection,{className:mn},r.createElement(a.InsightsEmailOptIn,{ouiaId:"list-email-required",content:h.pages.listPage.emailOptIn,insights:(0,a.getInsights)()})),r.createElement(l.Main,null,!1===p.hasPolicies?r.createElement(on,{createPolicy:N?F.createCustomPolicy:void 0}):r.createElement(l.Section,null,r.createElement(fe,{ouiaId:"main-toolbar",onCreatePolicy:N?F.createCustomPolicy:void 0,onDeletePolicy:N?F.onDeletePolicies:void 0,onEnablePolicy:N?F.onEnablePolicies:void 0,onDisablePolicy:N?F.onDisablePolicies:void 0,onPaginationChanged:u.changePage,onPaginationSizeChanged:u.changeItemsPerPage,onSelectionChanged:C.onSelectionChanged,selectedCount:C.selectionCount,page:u.page.index,pageCount:C.rows.length,perPage:u.page.size,showPerPageOptions:!0,filters:c.filters,setFilters:c.setFilters,clearFilters:c.clearFilter,count:b,onExport:F.onExport,showBottomPagination:!0},r.createElement(ye,{ouiaId:"main-table",policies:C.rows,onCollapse:C.onCollapse,onSelect:C.onSelect,actionResolver:D,loading:v,error:V,onSort:d.onSort,sortBy:d.sortBy,linkToDetailPolicy:!0})))),i.isOpen&&r.createElement(Ji,{isOpen:i.isOpen,close:M,initialValue:i.template,showCreateStep:i.showCreateStep,policiesExist:!0===p.hasPolicies,isEditing:i.isEditing}),g.isOpen&&r.createElement(nn,{onClose:L.onCloseDeletePolicy,onDeleted:L.onDeleted,loading:C.loadingSelected,count:g.count,getPolicies:C.getSelected,policy:g.policy}))}},{path:Yn.policyDetail(":policyId"),component:()=>{var e,t;const{policyId:i,policy:n,setPolicy:o}=(()=>{const{policyId:e}=(0,v.UO)(),t=(0,_.Z)(e),i=(0,v.k6)(),[n,a]=r.useState(),o=(null==n?void 0:n.id)||e,l=r.useCallback(((e,t)=>{(0,Cn.unstable_batchedUpdates)((()=>{a(t),i.push(Yn.policyDetail(e))}))}),[i,a]),s=r.useCallback((t=>{e!==t.id?l(t.id,t):a(t)}),[l,e]);return(0,r.useEffect)((()=>{t!==e&&(n&&n.id===e||a(void 0))}),[e,t,l,i,n,o]),{policyId:o,policy:n,setPolicy:s}})(),c=(0,r.useContext)(T),{canReadPolicies:d,canWritePolicies:u}=c.rbac,p=(0,v.k6)(),m=Ve(),g=(0,a.useTransformQueryResponse)((0,Re.useParameterizedQuery)(gn),yn),y=Ke(),b=(e=>{const[t,i]=r.useReducer(((t,i)=>{if(!e)return Pn;switch(i){case Tn.CLOSE:return Pn;case Tn.DUPLICATE:return{isEditing:!1,initialValue:Qe(e),isOpen:!0};case Tn.EDIT:return{isEditing:!0,initialValue:e,isOpen:!0};default:return(0,P.vE)(i)}}),Pn);return{data:t,close:(0,r.useCallback)((()=>i(Tn.CLOSE)),[i]),duplicate:(0,r.useCallback)((()=>i(Tn.DUPLICATE)),[i]),edit:(0,r.useCallback)((()=>i(Tn.EDIT)),[i])}})(n),C=r.useRef(null),S=r.useCallback((e=>{var t;"Policy"===(null===(t=e.payload)||void 0===t?void 0:t.type)&&o(e.payload.value)}),[o]);r.useEffect((()=>{const e=g.query;i!==(null==n?void 0:n.id)&&e(i).then(S)}),[i,g.query,n,o,S]);const x=r.useCallback((e=>{const t=b.close;e&&o(e),t()}),[o,b.close]),O=r.useCallback((()=>{const e=m.open;n&&e(n)}),[n,m.open]),N=r.useCallback((e=>{const t=m.close;e?p.push(Yn.listPage()):t()}),[p,m.close]),I=r.useCallback((e=>{n&&o(Object.assign(Object.assign({},n),{isEnabled:e}))}),[n,o]),R=r.useCallback((e=>{(0,y.mutate)({policyIds:[i],shouldBeEnabled:e}).then((t=>{var n;200===(null===(n=t.payload)||void 0===n?void 0:n.status)?t.payload.value.includes(i)?I(e):(0,a.addDangerNotification)(h.pages.policyDetail.errorChangingEnabledStatus.notFound.title,h.pages.policyDetail.errorChangingEnabledStatus.notFound.text):(0,a.addDangerNotification)(h.pages.policyDetail.errorChangingEnabledStatus.else.title,h.pages.policyDetail.errorChangingEnabledStatus.else.text)}))}),[i,y.mutate,I]);if(!d)return r.createElement(E,null);if(void 0===n){if(404===g.status)return r.createElement(bn,{policyId:i||""});if(!g.loading&&"Policy"!==(null===(e=g.payload)||void 0===e?void 0:e.type)){let e=`code: ${g.status}`;return"Msg"===(null===(t=g.payload)||void 0===t?void 0:t.type)&&g.payload.value.msg&&(e=g.payload.value.msg),r.createElement(_n,{action:()=>{var e;null===(e=C.current)||void 0===e||e.refresh(),g.query(i).then(S)},error:e})}return r.createElement(In,null)}return r.createElement(r.Fragment,null,r.createElement(f.q,null,r.createElement("title",null,n.name," - Policies | Red Hat Insights")),r.createElement(l.PageHeader,null,r.createElement(s.Stack,null,r.createElement(s.StackItem,null,r.createElement(s.Breadcrumb,null,r.createElement(a.BreadcrumbLinkItem,{ouiaId:"to-list-page",to:Yn.listPage()},"Policies"),r.createElement(s.BreadcrumbItem,{to:"#",isActive:!0},n.name))),r.createElement(s.StackItem,null,r.createElement(s.Split,null,r.createElement(s.SplitItem,{isFilled:!0},r.createElement(l.PageHeaderTitle,{title:n.name})),r.createElement(s.SplitItem,null,r.createElement(hn,{isEnabled:n.isEnabled,disabled:!u,edit:b.edit,duplicate:b.duplicate,delete:O,changeEnabled:R,loadingEnabledChange:y.loading})))))),r.createElement(l.Main,null,r.createElement(a.Section,{ouiaId:"policy-detail",style:{paddingBottom:"4px"}},r.createElement(xn,{isEnabled:n.isEnabled,loading:y.loading}),r.createElement(oe,{actions:n.actions,description:n.description,created:n.ctime,updated:n.mtime,conditions:n.conditions})),r.createElement("div",{className:Kn},r.createElement(s.Title,{headingLevel:"h2",size:"lg"},"Recent trigger history")),r.createElement(Wn,{policyId:i,ref:C})),b.data.isOpen&&r.createElement(Ji,{isOpen:!0,close:x,showCreateStep:!1,policiesExist:!1,initialValue:b.data.initialValue,isEditing:b.data.isEditing}),m.isOpen&&r.createElement(nn,{onClose:N,loading:!1,count:m.count,policy:m.policy}))}}],Jn=e=>r.createElement(b,null,r.createElement(v.AW,Object.assign({},e))),ea=()=>r.createElement(v.rs,null,Xn.map((e=>r.createElement(Jn,{key:e.path,component:e.component,path:e.path}))),r.createElement(v.l_,{to:Yn.listPage()})),ta=Te.apis.urls,ia=e=>{const t={dailyEmail:!1,immediateEmail:!1};return e.forEach((e=>e.fields.forEach((e=>{"dailyEmail"===e.name?t.dailyEmail=e.initialValue:"immediateEmail"===e.name&&(t.immediateEmail=e.initialValue)})))),t},na=()=>{const{rbac:e,userSettings:t}=(()=>{const e=(0,v.k6)(),[t,i]=(0,r.useState)(void 0),n=(e=>{const t=(0,a.useTransformQueryResponse)((0,Re.useQuery)((0,Ae.actionBuilder)("GET",ta.userSettings.email).build(),void 0),ia),i=t.query;return(0,a.useSyncInterval)(e,(0,r.useCallback)((()=>{i()}),[i])),(0,r.useMemo)((()=>{let e=!1;const n=t.payload;return n&&(e=!!n.dailyEmail||!!n.immediateEmail),{settings:t.payload,refresh:i,isSubscribedForNotifications:e}}),[t.payload,i])})(9e5);return(0,r.useEffect)((()=>{(0,a.waitForInsights)().then((e=>{e.chrome.init(),e.chrome.identifyApp(Te.appId),e.chrome.hasOwnProperty("hideGlobalFilter")&&e.chrome.hideGlobalFilter&&e.chrome.hideGlobalFilter()}))}),[e]),(0,r.useEffect)((()=>{(0,a.waitForInsights)().then((e=>{e.chrome.auth.getUser().then((()=>{(0,a.fetchRBAC)(Te.appId).then(i)}))}))}),[]),{rbac:t?{canReadPolicies:t.hasPermission("policies","policies","read"),canWritePolicies:t.hasPermission("policies","policies","write")}:void 0,userSettings:n}})();return e?r.createElement(T.Provider,{value:{rbac:e,userSettings:t}},e.canReadPolicies?r.createElement(r.Fragment,null,r.createElement(n.NotificationsPortal,null),r.createElement(ea,null)):r.createElement(E,null)):r.createElement(a.AppSkeleton,null)}},1833:(e,t,i)=>{"use strict";i.d(t,{M:()=>a,i:()=>r});var n=i(55128);const a=(...e)=>(0,n.initStore)({},{},...e),r=()=>(0,n.restoreStore)()}}]);
//# sourceMappingURL=661.c3bab851ad3379397652.js.map